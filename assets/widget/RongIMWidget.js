function QiniuJsSDK(){var e;e="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com",this.detectIEVersion=function(){for(var e=4,t=document.createElement("div"),o=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+e+"]><i></i><![endif]-->",o[0];)e++;return e>4?e:!1},this.isImage=function(e){var t,o="",n=["png","jpg","jpeg","gif","bmp"],i=/\.([a-zA-Z0-9]+)(\?|\@|$)/;if(!e||!i.test(e))return!1;t=i.exec(e),o=t[1].toLowerCase();for(var r=0,s=n.length;s>r;r++)if(o===n[r])return!0;return!1},this.getFileExtension=function(e){var t,o=e.split(".");return t=1===o.length||""===o[0]&&2===o.length?"":o.pop().toLowerCase()},this.utf8_encode=function(e){if(null===e||"undefined"==typeof e)return"";var t,o,n=e+"",i="",r=0;t=o=0,r=n.length;for(var s=0;r>s;s++){var a=n.charCodeAt(s),c=null;if(128>a)o++;else if(a>127&&2048>a)c=String.fromCharCode(a>>6|192,63&a|128);else if(63488&a^!0)c=String.fromCharCode(a>>12|224,a>>6&63|128,63&a|128);else{if(64512&a^!0)throw new RangeError("Unmatched trail surrogate at "+s);var l=n.charCodeAt(++s);if(64512&l^!0)throw new RangeError("Unmatched lead surrogate at "+(s-1));a=((1023&a)<<10)+(1023&l)+65536,c=String.fromCharCode(a>>18|240,a>>12&63|128,a>>6&63|128,63&a|128)}null!==c&&(o>t&&(i+=n.slice(t,o)),i+=c,t=o=s+1)}return o>t&&(i+=n.slice(t,r)),i},this.base64_encode=function(e){var t,o,n,i,r,s,a,c,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,u=0,g="",p=[];if(!e)return e;e=this.utf8_encode(e+"");do t=e.charCodeAt(d++),o=e.charCodeAt(d++),n=e.charCodeAt(d++),c=t<<16|o<<8|n,i=c>>18&63,r=c>>12&63,s=c>>6&63,a=63&c,p[u++]=l.charAt(i)+l.charAt(r)+l.charAt(s)+l.charAt(a);while(d<e.length);switch(g=p.join(""),e.length%3){case 1:g=g.slice(0,-2)+"==";break;case 2:g=g.slice(0,-1)+"="}return g},this.URLSafeBase64Encode=function(e){return e=this.base64_encode(e),e.replace(/\//g,"_").replace(/\+/g,"-")},this.createAjax=function(e){var t={};return t=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")},this.parseJSON=function(e){return window.JSON&&window.JSON.parse?window.JSON.parse(e):null===e?e:"string"==typeof e&&(e=this.trim(e),e&&/^[\],:{}\s]*$/.test(e.replace(/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,"@").replace(/"[^"\\\r\n]*"|true|false|null|-?(?:\d+\.|)\d+(?:[eE][+-]?\d+|)/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))?function(){return e}():void 0},this.trim=function(e){return null===e?"":e.replace(/^\s+|\s+$/g,"")};var t=this;this.uploader=function(o){if(!o.domain)throw"uptoken_url or domain is required!";if(!o.browse_button)throw"browse_button is required!";var n={},i=o.init&&o.init.Error,r=o.init&&o.init.FileUploaded;o.init.Error=function(){},o.init.FileUploaded=function(){},t.uptoken_url=o.uptoken_url,t.token="",t.key_handler="function"==typeof o.init.Key?o.init.Key:"",this.domain=o.domain;var s="",a={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""},c=function(){var e,n,i,r=t.detectIEVersion(),s="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;r&&9>=r&&o.chunk_size&&o.runtimes.indexOf("flash")>=0?o.chunk_size=0:s?o.chunk_size=0:(e=20,n=4<<e,i=plupload.parseSize(o.chunk_size),i>n&&(o.chunk_size=n))};c();var l=function(){if(o.uptoken)t.token=o.uptoken;else{var e=t.createAjax();e.open("GET",t.uptoken_url,!0),e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){var o=t.parseJSON(e.responseText);t.token=o.uptoken}},e.send()}},d=function(e,n,i){var r="",s=!1;if(!o.save_key)if(s=e.getOption&&e.getOption("unique_names"),s=s||e.settings&&e.settings.unique_names){var a=t.getFileExtension(n.name);r=a?n.id+"."+a:n.id}else r="function"==typeof i?i(e,n):n.name;return r};plupload.extend(n,o,{url:e,multipart_params:{token:""}});var u=new plupload.Uploader(n);return u.bind("Init",function(e,t){l()}),u.init(),u.bind("FilesAdded",function(e,t){var o=e.getOption&&e.getOption("auto_start");o=o||e.settings&&e.settings.auto_start,o&&plupload.each(t,function(t,o){e.start()}),e.refresh()}),u.bind("BeforeUpload",function(n,i){i.speed=i.speed||0,s="",o.get_new_uptoken&&l();var r=function(n,i,r){a.startTime=(new Date).getTime();var s;s=o.save_key?{token:t.token}:{key:d(n,i,r),token:t.token};var c=o.x_vars;if(void 0!==c&&"object"==typeof c)for(var l in c)c.hasOwnProperty(l)&&("function"==typeof c[l]?s["x:"+l]=c[l](n,i):"object"!=typeof c[l]&&(s["x:"+l]=c[l]));n.setOption({url:e,multipart:!0,chunk_size:void 0,multipart_params:s})},c=n.getOption&&n.getOption("chunk_size");if(c=c||n.settings&&n.settings.chunk_size,"html5"===u.runtime&&c)if(i.size<c)r(n,i,t.key_handler);else{var g=localStorage.getItem(i.name),p=c;if(g){g=JSON.parse(g);var h=(new Date).getTime(),m=g.time||0,f=864e5;f>h-m&&100!==g.percent&&i.size===g.total?(i.percent=g.percent,i.loaded=g.offset,s=g.ctx,a.isResumeUpload=!0,a.resumeFilesize=g.offset,g.offset+p>i.size&&(p=i.size-g.offset)):localStorage.removeItem(i.name)}a.startTime=(new Date).getTime(),n.setOption({url:e+"/mkblk/"+p,multipart:!1,chunk_size:c,required_features:"chunks",headers:{Authorization:"UpToken "+t.token},multipart_params:{}})}else r(n,i,t.key_handler)}),u.bind("UploadProgress",function(e,t){a.currentTime=(new Date).getTime();var o=a.currentTime-a.startTime,n=t.loaded||0;a.isResumeUpload&&(n=t.loaded-a.resumeFilesize),t.speed=(n/o*1e3).toFixed(0)||0}),u.bind("ChunkUploaded",function(o,n,i){var r=t.parseJSON(i.response);s=s?s+","+r.ctx:r.ctx;var a=i.total-i.offset,c=o.getOption&&o.getOption("chunk_size");c=c||o.settings&&o.settings.chunk_size,c>a&&o.setOption({url:e+"/mkblk/"+a}),localStorage.setItem(n.name,JSON.stringify({ctx:s,percent:n.percent,total:i.total,offset:i.offset,time:(new Date).getTime()}))}),u.bind("Error",function(e){return function(o,n){var i="",r=n.file;if(r){switch(n.code){case plupload.FAILED:i="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:var s=o.getOption&&o.getOption("max_file_size");s=s||o.settings&&o.settings.max_file_size,i="浏览器最大可上传"+s+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:i="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===n.response){i=n.message||"未知网络错误。";break}var a=t.parseJSON(n.response),c=a.error;switch(n.status){case 400:i="请求报文格式错误。";break;case 401:i="客户端认证授权失败。请重试或提交反馈。";break;case 405:i="客户端请求错误。请重试或提交反馈。";break;case 579:i="资源上传成功，但回调失败。";break;case 599:i="网络连接异常。请重试或提交反馈。";break;case 614:i="文件已存在。";try{a=t.parseJSON(a.error),c=a.error||"file exists"}catch(l){c=a.error||"file exists"}break;case 631:i="指定空间不存在。";break;case 701:i="上传数据块校验出错。请重试或提交反馈。";break;default:i="未知错误。"}i=i+"("+n.status+"："+c+")";break;case plupload.SECURITY_ERROR:i="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:i="上传失败。请稍后再试。";break;case plupload.IO_ERROR:i="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:i="网站配置错误。请联系网站管理员。",u.destroy();break;default:i=n.message+n.details}e&&e(o,n,i)}o.refresh()}}(i)),u.bind("FileUploaded",function(n){return function(i,r,a){var c=function(e,i,r){if(o.downtoken_url){var s=t.createAjax();s.open("POST",o.downtoken_url,!0),s.setRequestHeader("Content-type","application/x-www-form-urlencoded"),s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){var o;try{o=t.parseJSON(s.responseText)}catch(a){throw"invalid json format"}var c={};plupload.extend(c,t.parseJSON(r),o),n&&n(e,i,JSON.stringify(c))}else u.trigger("Error",{status:s.status,response:s.responseText,file:i,code:plupload.HTTP_ERROR})},s.send("key="+t.parseJSON(r).key+"&domain="+o.domain)}else n&&n(e,i,r)};a.response=a.response.replace(/'/g,'"');var l=t.parseJSON(a.response);if(s=s?s:l.ctx){var g="";o.save_key||(g=d(i,r,t.key_handler),g=g?"/key/"+t.URLSafeBase64Encode(g):"");var p="/fname/"+t.URLSafeBase64Encode(r.name),h=o.x_vars,m="",f="";if(void 0!==h&&"object"==typeof h)for(var v in h)h.hasOwnProperty(v)&&("function"==typeof h[v]?m=t.URLSafeBase64Encode(h[v](i,r)):"object"!=typeof h[v]&&(m=t.URLSafeBase64Encode(h[v])),f+="/x:"+v+"/"+m);var b=e+"/mkfile/"+r.size+g+p+f,y=t.createAjax();y.open("POST",b,!0),y.setRequestHeader("Content-Type","text/plain;charset=UTF-8"),y.setRequestHeader("Authorization","UpToken "+t.token),y.onreadystatechange=function(){if(4===y.readyState)if(localStorage.removeItem(r.name),200===y.status){var e=y.responseText;c(i,r,e)}else u.trigger("Error",{status:y.status,response:y.responseText,file:r,code:-200})},y.send(s)}else c(i,r,a.response)}}(r)),u},this.getUrl=function(e){if(!e)return!1;e=encodeURI(e);var t=this.domain;return"/"!==t.slice(t.length-1)&&(t+="/"),t+e},this.imageView2=function(e,t){var o=e.mode||"",n=e.w||"",i=e.h||"",r=e.q||"",s=e.format||"";if(!o)return!1;if(!n&&!i)return!1;var a="imageView2/"+o;return a+=n?"/w/"+n:"",a+=i?"/h/"+i:"",a+=r?"/q/"+r:"",a+=s?"/format/"+s:"",t&&(a=this.getUrl(t)+"?"+a),a},this.imageMogr2=function(e,t){var o=e["auto-orient"]||"",n=e.thumbnail||"",i=e.strip||"",r=e.gravity||"",s=e.crop||"",a=e.quality||"",c=e.rotate||"",l=e.format||"",d=e.blur||"",u="imageMogr2";return u+=o?"/auto-orient":"",u+=n?"/thumbnail/"+n:"",u+=i?"/strip":"",u+=r?"/gravity/"+r:"",u+=a?"/quality/"+a:"",u+=s?"/crop/"+s:"",u+=c?"/rotate/"+c:"",u+=l?"/format/"+l:"",u+=d?"/blur/"+d:"",t&&(u=this.getUrl(t)+"?"+u),u},this.watermark=function(e,t){var o=e.mode;if(!o)return!1;var n="watermark/"+o;if(1===o){var i=e.image||"";if(!i)return!1;n+=i?"/image/"+this.URLSafeBase64Encode(i):""}else{if(2!==o)return!1;var r=e.text?e.text:"",s=e.font?e.font:"",a=e.fontsize?e.fontsize:"",c=e.fill?e.fill:"";if(!r)return!1;n+=r?"/text/"+this.URLSafeBase64Encode(r):"",n+=s?"/font/"+this.URLSafeBase64Encode(s):"",n+=a?"/fontsize/"+a:"",n+=c?"/fill/"+this.URLSafeBase64Encode(c):""}var l=e.dissolve||"",d=e.gravity||"",u=e.dx||"",g=e.dy||"";return n+=l?"/dissolve/"+l:"",n+=d?"/gravity/"+d:"",n+=u?"/dx/"+u:"",n+=g?"/dy/"+g:"",t&&(n=this.getUrl(t)+"?"+n),n},this.imageInfo=function(e){if(!e)return!1;var t,o=this.getUrl(e)+"?imageInfo",n=this.createAjax(),i=this;return n.open("GET",o,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(t=i.parseJSON(n.responseText))},n.send(),t},this.exif=function(e){if(!e)return!1;var t,o=this.getUrl(e)+"?exif",n=this.createAjax(),i=this;return n.open("GET",o,!1),n.onreadystatechange=function(){4===n.readyState&&200===n.status&&(t=i.parseJSON(n.responseText))},n.send(),t},this.get=function(e,t){return t&&e?"exif"===e?this.exif(t):"imageInfo"===e?this.imageInfo(t):!1:!1},this.pipeline=function(e,t){var o,n,i="[object Array]"===Object.prototype.toString.call(e),r="";if(i){for(var s=0,a=e.length;a>s;s++){if(o=e[s],!o.fop)return!1;switch(o.fop){case"watermark":r+=this.watermark(o)+"|";break;case"imageView2":r+=this.imageView2(o)+"|";break;case"imageMogr2":r+=this.imageMogr2(o)+"|";break;default:n=!0}if(n)return!1}if(t){r=this.getUrl(t)+"?"+r;var c=r.length;"|"===r.slice(c-1)&&(r=r.slice(0,c-1))}return r}return!1}}!function($){$&&($.rebox=function(e,t){this.settings=$.extend(!0,{},$.rebox.defaults,t),this.$el=e,this.$box=null,this.$items=null,this.idx=0,this.enable()},$.rebox.defaults={theme:"rebox",selector:null,prev:"&larr;",next:"&rarr;",loading:"%",close:"&times;",speed:400,zIndex:1e3,cycle:!0,captionAttr:"title",template:"image",templates:{image:function(e,t,o){return $('<img src="'+e.attr("href")+'" class="'+t.theme+'-content" />').load(o)}}},$.rebox.setDefaults=function(e){$.rebox.defaults=$.extend(!0,{},$.rebox.defaults,e)},$.rebox.lookup={i:0},$.extend($.rebox.prototype,{enable:function(){var e=this;return e.$el.on("click.rebox",e.settings.selector,function(t){t.preventDefault(),e.open(this)})},open:function(e){var t=this;return t.$items=null===t.settings.selector?t.$el:t.$el.find(t.settings.selector),isNaN(e)&&(e=t.$items.index(e)),t.$box=$('<div class="'+t.settings.theme+'" style="display:none;"><a href="#" class="'+t.settings.theme+"-close "+t.settings.theme+'-button">'+t.settings.close+'</a><a href="#" class="'+t.settings.theme+"-prev "+t.settings.theme+'-button">'+t.settings.prev+'</a><a href="#" class="'+t.settings.theme+"-next "+t.settings.theme+'-button">'+t.settings.next+'</a><div class="'+t.settings.theme+'-contents"></div><div class="'+t.settings.theme+'-caption"><p></p></div></div>').appendTo("body").css("zIndex",t.settings.zIndex).fadeIn(t.settings.speed).on("click.rebox","."+t.settings.theme+"-close",function(e){e.preventDefault(),t.close()}).on("click.rebox","."+t.settings.theme+"-next",function(e){e.preventDefault(),t.next()}).on("click.rebox","."+t.settings.theme+"-prev",function(e){e.preventDefault(),t.prev()}),$(document).on("swipeLeft.rebox",function(e){t.next()}).on("swipeRight.rebox",function(e){t.prev()}).on("keydown.rebox",function(e){e.preventDefault();var o=window.event?event.keyCode:e.keyCode;switch(o){case 27:t.close();break;case 37:t.prev();break;case 39:t.next()}}),t.$el.trigger("rebox:open",[t]),t["goto"](e),t.$el},close:function(){var e=this;return e.$box&&e.$box.length&&e.$box.fadeOut(e.settings.speed,function(t){e.$box.remove(),e.$box=null,e.$el.trigger("rebox:close",[e])}),$(document).off(".rebox"),e.$el},"goto":function(e){var t=this,o=$(t.$items[e]),n=o.attr(t.settings.captionAttr),i=(t.$box.children("."+t.settings.theme+"-caption")[n?"show":"hide"]().children("p").text(n),t.$box.children("."+t.settings.theme+"-contents")),r=null;return o.length&&(t.idx=e,i.html('<div class="'+t.settings.theme+"-loading "+t.settings.theme+'-button">'+t.settings.loading+"</div>"),r=t.settings.templates[o.data("rebox-template")||t.settings.template](o,t.settings,function(e){i.empty().append($(this))}),1!=t.$items.length&&t.settings.cycle||(t.$box.children("."+t.settings.theme+"-prev")[0>=e?"hide":"show"](),t.$box.children("."+t.settings.theme+"-next")[e>=t.$items.length-1?"hide":"show"]()),t.$el.trigger("rebox:goto",[t,e,o,r])),t.$el},prev:function(){var e=this;return e["goto"](0===e.idx?e.$items.length-1:e.idx-1)},next:function(){var e=this;return e["goto"](e.idx===e.$items.length-1?0:e.idx+1)},disable:function(){var e=this;return e.close().off(".rebox").trigger("rebox:disable",[e])},destroy:function(){var e=this;return e.disable().removeData("rebox").trigger("rebox:destroy")},option:function(e,t){var o=this;return void 0!==t?(o.settings[e]=t,o.disable().enable()):o.settings[e]}}),$.fn.rebox=function(e){e=e||{};var t=Array.prototype.slice.call(arguments);if("string"==typeof e){if("option"==e&&"string"==typeof t[1]&&2===t.length){var o=$.rebox.lookup[$(this).data("rebox")];return o[e].apply(o,t.slice(1))}return this.each(function(){var o=$.rebox.lookup[$(this).data("rebox")];o[e].apply(o,t.slice(1))})}return this.each(function(){var t=$(this);$.rebox.lookup[++$.rebox.lookup.i]=new $.rebox(t,e),t.data("rebox",$.rebox.lookup.i)})})}(window.jQuery||window.Zepto||window.$),function(e){"function"==typeof define&&define.amd?define(["jquery"],e):"object"==typeof exports?module.exports=e(require("jquery")):e(jQuery)}(function(e){var t=!1,o=!1,n=0,i=2e3,r=0,s=["webkit","ms","moz","o"],a=window.requestAnimationFrame||!1,c=window.cancelAnimationFrame||!1;if(!a)for(var l in s){var d=s[l];if(a=window[d+"RequestAnimationFrame"]){c=window[d+"CancelAnimationFrame"]||window[d+"CancelRequestAnimationFrame"];break}}var u=window.MutationObserver||window.WebKitMutationObserver||!1,g={zindex:"auto",cursoropacitymin:0,cursoropacitymax:1,cursorcolor:"#424242",cursorwidth:"6px",cursorborder:"1px solid #fff",cursorborderradius:"5px",scrollspeed:60,mousescrollstep:24,touchbehavior:!1,hwacceleration:!0,usetransition:!0,boxzoom:!1,dblclickzoom:!0,gesturezoom:!0,grabcursorenabled:!0,autohidemode:!0,background:"",iframeautoresize:!0,cursorminheight:32,preservenativescrolling:!0,railoffset:!1,railhoffset:!1,bouncescroll:!0,spacebarenabled:!0,railpadding:{top:0,right:0,left:0,bottom:0},disableoutline:!0,horizrailenabled:!0,railalign:"right",railvalign:"bottom",enabletranslate3d:!0,enablemousewheel:!0,enablekeyboard:!0,smoothscroll:!0,sensitiverail:!0,enablemouselockapi:!0,cursorfixedheight:!1,directionlockdeadzone:6,hidecursordelay:400,nativeparentscrolling:!0,enablescrollonselection:!0,overflowx:!0,overflowy:!0,cursordragspeed:.3,rtlmode:"auto",cursordragontouch:!1,oneaxismousemode:"auto",scriptpath:function(){var e=document.getElementsByTagName("script"),e=e.length?e[e.length-1].src.split("?")[0]:"";return 0<e.split("/").length?e.split("/").slice(0,-1).join("/")+"/":""}(),preventmultitouchscrolling:!0,disablemutationobserver:!1},p=!1,h=function(){if(p)return p;var e=document.createElement("DIV"),t=e.style,o=navigator.userAgent,n=navigator.platform,i={haspointerlock:"pointerLockElement"in document||"webkitPointerLockElement"in document||"mozPointerLockElement"in document};i.isopera="opera"in window,i.isopera12=i.isopera&&"getUserMedia"in navigator,i.isoperamini="[object OperaMini]"===Object.prototype.toString.call(window.operamini),i.isie="all"in document&&"attachEvent"in e&&!i.isopera,i.isieold=i.isie&&!("msInterpolationMode"in t),i.isie7=i.isie&&!i.isieold&&(!("documentMode"in document)||7==document.documentMode),i.isie8=i.isie&&"documentMode"in document&&8==document.documentMode,i.isie9=i.isie&&"performance"in window&&9==document.documentMode,i.isie10=i.isie&&"performance"in window&&10==document.documentMode,i.isie11="msRequestFullscreen"in e&&11<=document.documentMode,i.isieedge12=navigator.userAgent.match(/Edge\/12\./),i.isieedge="msOverflowStyle"in e,i.ismodernie=i.isie11||i.isieedge,i.isie9mobile=/iemobile.9/i.test(o),i.isie9mobile&&(i.isie9=!1),i.isie7mobile=!i.isie9mobile&&i.isie7&&/iemobile/i.test(o),i.ismozilla="MozAppearance"in t,i.iswebkit="WebkitAppearance"in t,i.ischrome="chrome"in window,i.ischrome38=i.ischrome&&"touchAction"in t,i.ischrome22=!i.ischrome38&&i.ischrome&&i.haspointerlock,i.ischrome26=!i.ischrome38&&i.ischrome&&"transition"in t,i.cantouch="ontouchstart"in document.documentElement||"ontouchstart"in window,i.hasw3ctouch=(window.PointerEvent||!1)&&(0<navigator.MaxTouchPoints||0<navigator.msMaxTouchPoints),i.hasmstouch=!i.hasw3ctouch&&(window.MSPointerEvent||!1),i.ismac=/^mac$/i.test(n),i.isios=i.cantouch&&/iphone|ipad|ipod/i.test(n),i.isios4=i.isios&&!("seal"in Object),i.isios7=i.isios&&"webkitHidden"in document,i.isios8=i.isios&&"hidden"in document,i.isandroid=/android/i.test(o),i.haseventlistener="addEventListener"in e,i.trstyle=!1,i.hastransform=!1,i.hastranslate3d=!1,i.transitionstyle=!1,i.hastransition=!1,i.transitionend=!1,n=["transform","msTransform","webkitTransform","MozTransform","OTransform"];for(o=0;o<n.length;o++)if(void 0!==t[n[o]]){i.trstyle=n[o];break}i.hastransform=!!i.trstyle,i.hastransform&&(t[i.trstyle]="translate3d(1px,2px,3px)",i.hastranslate3d=/translate3d/.test(t[i.trstyle])),i.transitionstyle=!1,i.prefixstyle="",i.transitionend=!1;for(var n="transition webkitTransition msTransition MozTransition OTransition OTransition KhtmlTransition".split(" "),r=" -webkit- -ms- -moz- -o- -o -khtml-".split(" "),s="transitionend webkitTransitionEnd msTransitionEnd transitionend otransitionend oTransitionEnd KhtmlTransitionEnd".split(" "),o=0;o<n.length;o++)if(n[o]in t){i.transitionstyle=n[o],i.prefixstyle=r[o],i.transitionend=s[o];break}i.ischrome26&&(i.prefixstyle=r[1]),i.hastransition=i.transitionstyle;e:{for(o=["grab","-webkit-grab","-moz-grab"],(i.ischrome&&!i.ischrome38||i.isie)&&(o=[]),n=0;n<o.length;n++)if(r=o[n],t.cursor=r,t.cursor==r){t=r;break e}t="url(//patriciaportfolio.googlecode.com/files/openhand.cur),n-resize"}return i.cursorgrabvalue=t,i.hasmousecapture="setCapture"in e,i.hasMutationObserver=!1!==u,p=i},m=function(s,l){function d(){var e=y.doc.css(S.trstyle);return e&&"matrix"==e.substr(0,6)?e.replace(/^.*\((.*)\)$/g,"$1").replace(/px/g,"").split(/, +/):!1}function p(){var e=y.win;if("zIndex"in e)return e.zIndex();for(;0<e.length&&9!=e[0].nodeType;){var t=e.css("zIndex");if(!isNaN(t)&&0!=t)return parseInt(t);e=e.parent()}return!1}function m(e,t,o){return t=e.css(t),e=parseFloat(t),isNaN(e)?(e=C[t]||0,o=3==e?o?y.win.outerHeight()-y.win.innerHeight():y.win.outerWidth()-y.win.innerWidth():1,y.isie8&&e&&(e+=1),o?e:0):e}function v(e,t,o,n){y._bind(e,t,function(n){n=n?n:window.event;var i={original:n,target:n.target||n.srcElement,type:"wheel",deltaMode:"MozMousePixelScroll"==n.type?0:1,deltaX:0,deltaZ:0,preventDefault:function(){return n.preventDefault?n.preventDefault():n.returnValue=!1,!1},stopImmediatePropagation:function(){n.stopImmediatePropagation?n.stopImmediatePropagation():n.cancelBubble=!0}};return"mousewheel"==t?(n.wheelDeltaX&&(i.deltaX=-.025*n.wheelDeltaX),n.wheelDeltaY&&(i.deltaY=-.025*n.wheelDeltaY),i.deltaY||i.deltaX||(i.deltaY=-.025*n.wheelDelta)):i.deltaY=n.detail,o.call(e,i)},n)}function b(e,t,o){var n,i;if(0==e.deltaMode?(n=-Math.floor(y.opt.mousescrollstep/54*e.deltaX),i=-Math.floor(y.opt.mousescrollstep/54*e.deltaY)):1==e.deltaMode&&(n=-Math.floor(e.deltaX*y.opt.mousescrollstep),i=-Math.floor(e.deltaY*y.opt.mousescrollstep)),t&&y.opt.oneaxismousemode&&0==n&&i&&(n=i,i=0,o&&(0>n?y.getScrollLeft()>=y.page.maxw:0>=y.getScrollLeft())&&(i=n,n=0)),y.isrtlmode&&(n=-n),n&&(y.scrollmom&&y.scrollmom.stop(),y.lastdeltax+=n,y.debounced("mousewheelx",function(){var e=y.lastdeltax;y.lastdeltax=0,y.rail.drag||y.doScrollLeftBy(e)},15)),i){if(y.opt.nativeparentscrolling&&o&&!y.ispage&&!y.zoomactive)if(0>i){if(y.getScrollTop()>=y.page.maxh)return!0}else if(0>=y.getScrollTop())return!0;y.scrollmom&&y.scrollmom.stop(),y.lastdeltay+=i,y.synched("mousewheely",function(){var e=y.lastdeltay;y.lastdeltay=0,y.rail.drag||y.doScrollBy(e)},15)}return e.stopImmediatePropagation(),e.preventDefault()}var y=this;if(this.version="3.6.8",this.name="nicescroll",this.me=l,this.opt={doc:e("body"),win:!1},e.extend(this.opt,g),this.opt.snapbackspeed=80,s)for(var w in y.opt)void 0!==s[w]&&(y.opt[w]=s[w]);if(y.opt.disablemutationobserver&&(u=!1),this.iddoc=(this.doc=y.opt.doc)&&this.doc[0]?this.doc[0].id||"":"",this.ispage=/^BODY|HTML/.test(y.opt.win?y.opt.win[0].nodeName:this.doc[0].nodeName),this.haswrapper=!1!==y.opt.win,this.win=y.opt.win||(this.ispage?e(window):this.doc),this.docscroll=this.ispage&&!this.haswrapper?e(window):this.win,this.body=e("body"),this.iframe=this.isfixed=this.viewport=!1,this.isiframe="IFRAME"==this.doc[0].nodeName&&"IFRAME"==this.win[0].nodeName,this.istextarea="TEXTAREA"==this.win[0].nodeName,this.forcescreen=!1,this.canshowonmouseevent="scroll"!=y.opt.autohidemode,this.page=this.view=this.onzoomout=this.onzoomin=this.onscrollcancel=this.onscrollend=this.onscrollstart=this.onclick=this.ongesturezoom=this.onkeypress=this.onmousewheel=this.onmousemove=this.onmouseup=this.onmousedown=!1,this.scroll={x:0,y:0},this.scrollratio={x:0,y:0},this.cursorheight=20,this.scrollvaluemax=0,"auto"==this.opt.rtlmode){w=this.win[0]==window?this.body:this.win;var M=w.css("writing-mode")||w.css("-webkit-writing-mode")||w.css("-ms-writing-mode")||w.css("-moz-writing-mode");"horizontal-tb"==M||"lr-tb"==M||""==M?(this.isrtlmode="rtl"==w.css("direction"),this.isvertical=!1):(this.isrtlmode="vertical-rl"==M||"tb"==M||"tb-rl"==M||"rl-tb"==M,this.isvertical="vertical-rl"==M||"tb"==M||"tb-rl"==M)}else this.isrtlmode=!0===this.opt.rtlmode,this.isvertical=!1;this.observerbody=this.observerremover=this.observer=this.scrollmom=this.scrollrunning=!1;do this.id="ascrail"+i++;while(document.getElementById(this.id));this.hasmousefocus=this.hasfocus=this.zoomactive=this.zoom=this.selectiondrag=this.cursorfreezed=this.cursor=this.rail=!1,this.visibility=!0,this.hidden=this.locked=this.railslocked=!1,this.cursoractive=!0,this.wheelprevented=!1,this.overflowx=y.opt.overflowx,this.overflowy=y.opt.overflowy,this.nativescrollingarea=!1,this.checkarea=0,this.events=[],this.saved={},this.delaylist={},this.synclist={},this.lastdeltay=this.lastdeltax=0,this.detected=h();var S=e.extend({},this.detected);this.ishwscroll=(this.canhwscroll=S.hastransform&&y.opt.hwacceleration)&&y.haswrapper,this.hasreversehr=this.isrtlmode?this.isvertical?!(S.iswebkit||S.isie||S.isie11):!(S.iswebkit||S.isie&&!S.isie10&&!S.isie11):!1,this.istouchcapable=!1,S.cantouch||!S.hasw3ctouch&&!S.hasmstouch?!S.cantouch||S.isios||S.isandroid||!S.iswebkit&&!S.ismozilla||(this.istouchcapable=!0):this.istouchcapable=!0,y.opt.enablemouselockapi||(S.hasmousecapture=!1,S.haspointerlock=!1),this.debounced=function(e,t,o){y&&(y.delaylist[e]||(t.call(y),y.delaylist[e]={h:a(function(){y.delaylist[e].fn.call(y),y.delaylist[e]=!1},o)}),y.delaylist[e].fn=t)};var x=!1;this.synched=function(e,t){return y.synclist[e]=t,function(){x||(a(function(){if(y){x=!1;for(var e in y.synclist){var t=y.synclist[e];t&&t.call(y),y.synclist[e]=!1}}}),x=!0)}(),e},this.unsynched=function(e){y.synclist[e]&&(y.synclist[e]=!1)},this.css=function(e,t){for(var o in t)y.saved.css.push([e,o,e.css(o)]),e.css(o,t[o])},this.scrollTop=function(e){return void 0===e?y.getScrollTop():y.setScrollTop(e)},this.scrollLeft=function(e){return void 0===e?y.getScrollLeft():y.setScrollLeft(e)};var I=function(e,t,o,n,i,r,s){this.st=e,this.ed=t,this.spd=o,this.p1=n||0,this.p2=i||1,this.p3=r||0,this.p4=s||1,this.ts=(new Date).getTime(),this.df=this.ed-this.st};if(I.prototype={B2:function(e){return 3*e*e*(1-e)},B3:function(e){return 3*e*(1-e)*(1-e)},B4:function(e){return(1-e)*(1-e)*(1-e)},getNow:function(){var e=1-((new Date).getTime()-this.ts)/this.spd,t=this.B2(e)+this.B3(e)+this.B4(e);return 0>e?this.ed:this.st+Math.round(this.df*t)},update:function(e,t){return this.st=this.getNow(),this.ed=e,this.spd=t,this.ts=(new Date).getTime(),this.df=this.ed-this.st,this}},this.ishwscroll){this.doc.translate={x:0,y:0,tx:"0px",ty:"0px"},S.hastranslate3d&&S.isios&&this.doc.css("-webkit-backface-visibility","hidden"),this.getScrollTop=function(e){if(!e){if(e=d())return 16==e.length?-e[13]:-e[5];if(y.timerscroll&&y.timerscroll.bz)return y.timerscroll.bz.getNow()}return y.doc.translate.y},this.getScrollLeft=function(e){if(!e){if(e=d())return 16==e.length?-e[12]:-e[4];if(y.timerscroll&&y.timerscroll.bh)return y.timerscroll.bh.getNow()}return y.doc.translate.x},this.notifyScrollEvent=function(e){var t=document.createEvent("UIEvents");t.initUIEvent("scroll",!1,!0,window,1),t.niceevent=!0,e.dispatchEvent(t)};var T=this.isrtlmode?1:-1;S.hastranslate3d&&y.opt.enabletranslate3d?(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(S.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=e*T+"px",y.doc.css(S.trstyle,"translate3d("+y.doc.translate.tx+","+y.doc.translate.ty+",0px)"),t||y.notifyScrollEvent(y.win[0])}):(this.setScrollTop=function(e,t){y.doc.translate.y=e,y.doc.translate.ty=-1*e+"px",y.doc.css(S.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])},this.setScrollLeft=function(e,t){y.doc.translate.x=e,y.doc.translate.tx=e*T+"px",y.doc.css(S.trstyle,"translate("+y.doc.translate.tx+","+y.doc.translate.ty+")"),t||y.notifyScrollEvent(y.win[0])})}else this.getScrollTop=function(){return y.docscroll.scrollTop()},this.setScrollTop=function(e){return setTimeout(function(){y&&y.docscroll.scrollTop(e)},1)},this.getScrollLeft=function(){return y.hasreversehr?y.detected.ismozilla?y.page.maxw-Math.abs(y.docscroll.scrollLeft()):y.page.maxw-y.docscroll.scrollLeft():y.docscroll.scrollLeft()},this.setScrollLeft=function(e){return setTimeout(function(){return y?(y.hasreversehr&&(e=y.detected.ismozilla?-(y.page.maxw-e):y.page.maxw-e),y.docscroll.scrollLeft(e)):void 0},1)};this.getTarget=function(e){return e?e.target?e.target:e.srcElement?e.srcElement:!1:!1},this.hasParent=function(e,t){if(!e)return!1;for(var o=e.target||e.srcElement||e||!1;o&&o.id!=t;)o=o.parentNode||!1;return!1!==o};var C={thin:1,medium:3,thick:5};this.getDocumentScrollOffset=function(){return{top:window.pageYOffset||document.documentElement.scrollTop,left:window.pageXOffset||document.documentElement.scrollLeft}},this.getOffset=function(){if(y.isfixed){var e=y.win.offset(),t=y.getDocumentScrollOffset();return e.top-=t.top,e.left-=t.left,e}return e=y.win.offset(),y.viewport?(t=y.viewport.offset(),{top:e.top-t.top,left:e.left-t.left}):e},this.updateScrollBar=function(e){var t,o,n;if(y.ishwscroll)y.rail.css({height:y.win.innerHeight()-(y.opt.railpadding.top+y.opt.railpadding.bottom)}),y.railh&&y.railh.css({width:y.win.innerWidth()-(y.opt.railpadding.left+y.opt.railpadding.right)});else{var i=y.getOffset();t=i.top,o=i.left-(y.opt.railpadding.left+y.opt.railpadding.right),t+=m(y.win,"border-top-width",!0),o+=y.rail.align?y.win.outerWidth()-m(y.win,"border-right-width")-y.rail.width:m(y.win,"border-left-width"),(n=y.opt.railoffset)&&(n.top&&(t+=n.top),n.left&&(o+=n.left)),y.railslocked||y.rail.css({top:t,left:o,height:(e?e.h:y.win.innerHeight())-(y.opt.railpadding.top+y.opt.railpadding.bottom)}),y.zoom&&y.zoom.css({top:t+1,left:1==y.rail.align?o-20:o+y.rail.width+4}),y.railh&&!y.railslocked&&(t=i.top,o=i.left,(n=y.opt.railhoffset)&&(n.top&&(t+=n.top),n.left&&(o+=n.left)),e=y.railh.align?t+m(y.win,"border-top-width",!0)+y.win.innerHeight()-y.railh.height:t+m(y.win,"border-top-width",!0),o+=m(y.win,"border-left-width"),y.railh.css({top:e-(y.opt.railpadding.top+y.opt.railpadding.bottom),left:o,width:y.railh.width}))}},this.doRailClick=function(e,t,o){var n;y.railslocked||(y.cancelEvent(e),t?(t=o?y.doScrollLeft:y.doScrollTop,n=o?(e.pageX-y.railh.offset().left-y.cursorwidth/2)*y.scrollratio.x:(e.pageY-y.rail.offset().top-y.cursorheight/2)*y.scrollratio.y,t(n)):(t=o?y.doScrollLeftBy:y.doScrollBy,n=o?y.scroll.x:y.scroll.y,e=o?e.pageX-y.railh.offset().left:e.pageY-y.rail.offset().top,o=o?y.view.w:y.view.h,t(n>=e?o:-o)))},y.hasanimationframe=a,y.hascancelanimationframe=c,y.hasanimationframe?y.hascancelanimationframe||(c=function(){y.cancelAnimationFrame=!0}):(a=function(e){return setTimeout(e,15-Math.floor(+new Date/1e3)%16)},c=clearTimeout),this.init=function(){if(y.saved.css=[],S.isie7mobile||S.isoperamini)return!0;S.hasmstouch&&y.css(y.ispage?e("html"):y.win,{_touchaction:"none"});var i=S.ismodernie||S.isie10?{"-ms-overflow-style":"none"}:{"overflow-y":"hidden"};if(y.zindex="auto",y.zindex=y.ispage||"auto"!=y.opt.zindex?y.opt.zindex:p()||"auto",!y.ispage&&"auto"!=y.zindex&&y.zindex>r&&(r=y.zindex),y.isie&&0==y.zindex&&"auto"==y.opt.zindex&&(y.zindex="auto"),!y.ispage||!S.cantouch&&!S.isieold&&!S.isie9mobile){var s=y.docscroll;y.ispage&&(s=y.haswrapper?y.win:y.doc),S.isie9mobile||y.css(s,i),y.ispage&&S.isie7&&("BODY"==y.doc[0].nodeName?y.css(e("html"),{"overflow-y":"hidden"}):"HTML"==y.doc[0].nodeName&&y.css(e("body"),i)),!S.isios||y.ispage||y.haswrapper||y.css(e("body"),{"-webkit-overflow-scrolling":"touch"});var a=e(document.createElement("div"));a.css({position:"relative",top:0,"float":"right",width:y.opt.cursorwidth,height:0,"background-color":y.opt.cursorcolor,border:y.opt.cursorborder,"background-clip":"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),a.hborder=parseFloat(a.outerHeight()-a.innerHeight()),a.addClass("nicescroll-cursors"),y.cursor=a;var c=e(document.createElement("div"));c.attr("id",y.id),c.addClass("nicescroll-rails nicescroll-rails-vr");var l,d,g,h=["left","right","top","bottom"];for(g in h)d=h[g],(l=y.opt.railpadding[d])?c.css("padding-"+d,l+"px"):y.opt.railpadding[d]=0;c.append(a),c.width=Math.max(parseFloat(y.opt.cursorwidth),a.outerWidth()),c.css({width:c.width+"px",zIndex:y.zindex,background:y.opt.background,cursor:"default"}),c.visibility=!0,c.scrollable=!0,c.align="left"==y.opt.railalign?0:1,y.rail=c,a=y.rail.drag=!1,!y.opt.boxzoom||y.ispage||S.isieold||(a=document.createElement("div"),y.bind(a,"click",y.doZoom),y.bind(a,"mouseenter",function(){y.zoom.css("opacity",y.opt.cursoropacitymax)}),y.bind(a,"mouseleave",function(){y.zoom.css("opacity",y.opt.cursoropacitymin)}),y.zoom=e(a),y.zoom.css({cursor:"pointer",zIndex:y.zindex,backgroundImage:"url("+y.opt.scriptpath+"zoomico.png)",height:18,width:18,backgroundPosition:"0px 0px"}),y.opt.dblclickzoom&&y.bind(y.win,"dblclick",y.doZoom),
S.cantouch&&y.opt.gesturezoom&&(y.ongesturezoom=function(e){return 1.5<e.scale&&y.doZoomIn(e),.8>e.scale&&y.doZoomOut(e),y.cancelEvent(e)},y.bind(y.win,"gestureend",y.ongesturezoom))),y.railh=!1;var m;if(y.opt.horizrailenabled&&(y.css(s,{overflowX:"hidden"}),a=e(document.createElement("div")),a.css({position:"absolute",top:0,height:y.opt.cursorwidth,width:0,backgroundColor:y.opt.cursorcolor,border:y.opt.cursorborder,backgroundClip:"padding-box","-webkit-border-radius":y.opt.cursorborderradius,"-moz-border-radius":y.opt.cursorborderradius,"border-radius":y.opt.cursorborderradius}),S.isieold&&a.css("overflow","hidden"),a.wborder=parseFloat(a.outerWidth()-a.innerWidth()),a.addClass("nicescroll-cursors"),y.cursorh=a,m=e(document.createElement("div")),m.attr("id",y.id+"-hr"),m.addClass("nicescroll-rails nicescroll-rails-hr"),m.height=Math.max(parseFloat(y.opt.cursorwidth),a.outerHeight()),m.css({height:m.height+"px",zIndex:y.zindex,background:y.opt.background}),m.append(a),m.visibility=!0,m.scrollable=!0,m.align="top"==y.opt.railvalign?0:1,y.railh=m,y.railh.drag=!1),y.ispage?(c.css({position:"fixed",top:0,height:"100%"}),c.align?c.css({right:0}):c.css({left:0}),y.body.append(c),y.railh&&(m.css({position:"fixed",left:0,width:"100%"}),m.align?m.css({bottom:0}):m.css({top:0}),y.body.append(m))):(y.ishwscroll?("static"==y.win.css("position")&&y.css(y.win,{position:"relative"}),s="HTML"==y.win[0].nodeName?y.body:y.win,e(s).scrollTop(0).scrollLeft(0),y.zoom&&(y.zoom.css({position:"absolute",top:1,right:0,"margin-right":c.width+4}),s.append(y.zoom)),c.css({position:"absolute",top:0}),c.align?c.css({right:0}):c.css({left:0}),s.append(c),m&&(m.css({position:"absolute",left:0,bottom:0}),m.align?m.css({bottom:0}):m.css({top:0}),s.append(m))):(y.isfixed="fixed"==y.win.css("position"),s=y.isfixed?"fixed":"absolute",y.isfixed||(y.viewport=y.getViewport(y.win[0])),y.viewport&&(y.body=y.viewport,0==/fixed|absolute/.test(y.viewport.css("position"))&&y.css(y.viewport,{position:"relative"})),c.css({position:s}),y.zoom&&y.zoom.css({position:s}),y.updateScrollBar(),y.body.append(c),y.zoom&&y.body.append(y.zoom),y.railh&&(m.css({position:s}),y.body.append(m))),S.isios&&y.css(y.win,{"-webkit-tap-highlight-color":"rgba(0,0,0,0)","-webkit-touch-callout":"none"}),S.isie&&y.opt.disableoutline&&y.win.attr("hideFocus","true"),S.iswebkit&&y.opt.disableoutline&&y.win.css("outline","none")),!1===y.opt.autohidemode?(y.autohidedom=!1,y.rail.css({opacity:y.opt.cursoropacitymax}),y.railh&&y.railh.css({opacity:y.opt.cursoropacitymax})):!0===y.opt.autohidemode||"leave"===y.opt.autohidemode?(y.autohidedom=e().add(y.rail),S.isie8&&(y.autohidedom=y.autohidedom.add(y.cursor)),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh)),y.railh&&S.isie8&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"scroll"==y.opt.autohidemode?(y.autohidedom=e().add(y.rail),y.railh&&(y.autohidedom=y.autohidedom.add(y.railh))):"cursor"==y.opt.autohidemode?(y.autohidedom=e().add(y.cursor),y.railh&&(y.autohidedom=y.autohidedom.add(y.cursorh))):"hidden"==y.opt.autohidemode&&(y.autohidedom=!1,y.hide(),y.railslocked=!1),S.isie9mobile)y.scrollmom=new f(y),y.onmangotouch=function(){var e=y.getScrollTop(),t=y.getScrollLeft();if(e==y.scrollmom.lastscrolly&&t==y.scrollmom.lastscrollx)return!0;var o=e-y.mangotouch.sy,n=t-y.mangotouch.sx;if(0!=Math.round(Math.sqrt(Math.pow(n,2)+Math.pow(o,2)))){var i=0>o?-1:1,r=0>n?-1:1,s=+new Date;y.mangotouch.lazy&&clearTimeout(y.mangotouch.lazy),80<s-y.mangotouch.tm||y.mangotouch.dry!=i||y.mangotouch.drx!=r?(y.scrollmom.stop(),y.scrollmom.reset(t,e),y.mangotouch.sy=e,y.mangotouch.ly=e,y.mangotouch.sx=t,y.mangotouch.lx=t,y.mangotouch.dry=i,y.mangotouch.drx=r,y.mangotouch.tm=s):(y.scrollmom.stop(),y.scrollmom.update(y.mangotouch.sx-n,y.mangotouch.sy-o),y.mangotouch.tm=s,o=Math.max(Math.abs(y.mangotouch.ly-e),Math.abs(y.mangotouch.lx-t)),y.mangotouch.ly=e,y.mangotouch.lx=t,o>2&&(y.mangotouch.lazy=setTimeout(function(){y.mangotouch.lazy=!1,y.mangotouch.dry=0,y.mangotouch.drx=0,y.mangotouch.tm=0,y.scrollmom.doMomentum(30)},100)))}},c=y.getScrollTop(),m=y.getScrollLeft(),y.mangotouch={sy:c,ly:c,dry:0,sx:m,lx:m,drx:0,lazy:!1,tm:0},y.bind(y.docscroll,"scroll",y.onmangotouch);else{if(S.cantouch||y.istouchcapable||y.opt.touchbehavior||S.hasmstouch){y.scrollmom=new f(y),y.ontouchstart=function(t){if(t.pointerType&&2!=t.pointerType&&"touch"!=t.pointerType)return!1;if(y.hasmoving=!1,!y.railslocked){var o;if(S.hasmstouch)for(o=t.target?t.target:!1;o;){var n=e(o).getNiceScroll();if(0<n.length&&n[0].me==y.me)break;if(0<n.length)return!1;if("DIV"==o.nodeName&&o.id==y.id)break;o=o.parentNode?o.parentNode:!1}if(y.cancelScroll(),(o=y.getTarget(t))&&/INPUT/i.test(o.nodeName)&&/range/i.test(o.type))return y.stopPropagation(t);if(!("clientX"in t)&&"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),y.forcescreen&&(n=t,t={original:t.original?t.original:t},t.clientX=n.screenX,t.clientY=n.screenY),y.rail.drag={x:t.clientX,y:t.clientY,sx:y.scroll.x,sy:y.scroll.y,st:y.getScrollTop(),sl:y.getScrollLeft(),pt:2,dl:!1},y.ispage||!y.opt.directionlockdeadzone)y.rail.drag.dl="f";else{var n=e(window).width(),i=e(window).height(),i=Math.max(0,Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)-i),n=Math.max(0,Math.max(document.body.scrollWidth,document.documentElement.scrollWidth)-n);y.rail.drag.ck=!y.rail.scrollable&&y.railh.scrollable?i>0?"v":!1:y.rail.scrollable&&!y.railh.scrollable&&n>0?"h":!1,y.rail.drag.ck||(y.rail.drag.dl="f")}if(y.opt.touchbehavior&&y.isiframe&&S.isie&&(n=y.win.position(),y.rail.drag.x+=n.left,y.rail.drag.y+=n.top),y.hasmoving=!1,y.lastmouseup=!1,y.scrollmom.reset(t.clientX,t.clientY),!S.cantouch&&!this.istouchcapable&&!t.pointerType){if(!o||!/INPUT|SELECT|TEXTAREA/i.test(o.nodeName))return!y.ispage&&S.hasmousecapture&&o.setCapture(),y.opt.touchbehavior?(o.onclick&&!o._onclick&&(o._onclick=o.onclick,o.onclick=function(e){return y.hasmoving?!1:void o._onclick.call(this,e)}),y.cancelEvent(t)):y.stopPropagation(t);/SUBMIT|CANCEL|BUTTON/i.test(e(o).attr("type"))&&(pc={tg:o,click:!1},y.preventclick=pc)}}},y.ontouchend=function(e){if(!y.rail.drag)return!0;if(2==y.rail.drag.pt){if(e.pointerType&&2!=e.pointerType&&"touch"!=e.pointerType)return!1;if(y.scrollmom.doMomentum(),y.rail.drag=!1,y.hasmoving&&(y.lastmouseup=!0,y.hideCursor(),S.hasmousecapture&&document.releaseCapture(),!S.cantouch))return y.cancelEvent(e)}else if(1==y.rail.drag.pt)return y.onmouseup(e)};var v=y.opt.touchbehavior&&y.isiframe&&!S.hasmousecapture;y.ontouchmove=function(t,o){if(!y.rail.drag||t.targetTouches&&y.opt.preventmultitouchscrolling&&1<t.targetTouches.length||t.pointerType&&2!=t.pointerType&&"touch"!=t.pointerType)return!1;if(2==y.rail.drag.pt){if(S.cantouch&&S.isios&&void 0===t.original)return!0;if(y.hasmoving=!0,y.preventclick&&!y.preventclick.click&&(y.preventclick.click=y.preventclick.tg.onclick||!1,y.preventclick.tg.onclick=y.onpreventclick),t=e.extend({original:t},t),"changedTouches"in t&&(t.clientX=t.changedTouches[0].clientX,t.clientY=t.changedTouches[0].clientY),y.forcescreen){var n=t;t={original:t.original?t.original:t},t.clientX=n.screenX,t.clientY=n.screenY}var i,n=i=0;v&&!o&&(i=y.win.position(),n=-i.left,i=-i.top);var r=t.clientY+i;i=r-y.rail.drag.y;var s=t.clientX+n,a=s-y.rail.drag.x,c=y.rail.drag.st-i;y.ishwscroll&&y.opt.bouncescroll?0>c?c=Math.round(c/2):c>y.page.maxh&&(c=y.page.maxh+Math.round((c-y.page.maxh)/2)):(0>c&&(r=c=0),c>y.page.maxh&&(c=y.page.maxh,r=0));var l;if(y.railh&&y.railh.scrollable&&(l=y.isrtlmode?a-y.rail.drag.sl:y.rail.drag.sl-a,y.ishwscroll&&y.opt.bouncescroll?0>l?l=Math.round(l/2):l>y.page.maxw&&(l=y.page.maxw+Math.round((l-y.page.maxw)/2)):(0>l&&(s=l=0),l>y.page.maxw&&(l=y.page.maxw,s=0))),n=!1,y.rail.drag.dl)n=!0,"v"==y.rail.drag.dl?l=y.rail.drag.sl:"h"==y.rail.drag.dl&&(c=y.rail.drag.st);else{i=Math.abs(i);var a=Math.abs(a),d=y.opt.directionlockdeadzone;if("v"==y.rail.drag.ck){if(i>d&&.3*i>=a)return y.rail.drag=!1,!0;a>d&&(y.rail.drag.dl="f",e("body").scrollTop(e("body").scrollTop()))}else if("h"==y.rail.drag.ck){if(a>d&&.3*a>=i)return y.rail.drag=!1,!0;i>d&&(y.rail.drag.dl="f",e("body").scrollLeft(e("body").scrollLeft()))}}if(y.synched("touchmove",function(){y.rail.drag&&2==y.rail.drag.pt&&(y.prepareTransition&&y.prepareTransition(0),y.rail.scrollable&&y.setScrollTop(c),y.scrollmom.update(s,r),y.railh&&y.railh.scrollable?(y.setScrollLeft(l),y.showCursor(c,l)):y.showCursor(c),S.isie10&&document.selection.clear())}),S.ischrome&&y.istouchcapable&&(n=!1),n)return y.cancelEvent(t)}else if(1==y.rail.drag.pt)return y.onmousemove(t)}}if(y.onmousedown=function(e,t){if(!y.rail.drag||1==y.rail.drag.pt){if(y.railslocked)return y.cancelEvent(e);y.cancelScroll(),y.rail.drag={x:e.clientX,y:e.clientY,sx:y.scroll.x,sy:y.scroll.y,pt:1,hr:!!t};var o=y.getTarget(e);return!y.ispage&&S.hasmousecapture&&o.setCapture(),y.isiframe&&!S.hasmousecapture&&(y.saved.csspointerevents=y.doc.css("pointer-events"),y.css(y.doc,{"pointer-events":"none"})),y.hasmoving=!1,y.cancelEvent(e)}},y.onmouseup=function(e){return y.rail.drag?1!=y.rail.drag.pt?!0:(S.hasmousecapture&&document.releaseCapture(),y.isiframe&&!S.hasmousecapture&&y.doc.css("pointer-events",y.saved.csspointerevents),y.rail.drag=!1,y.hasmoving&&y.triggerScrollEnd(),y.cancelEvent(e)):void 0},y.onmousemove=function(e){if(y.rail.drag){if(1==y.rail.drag.pt){if(S.ischrome&&0==e.which)return y.onmouseup(e);if(y.cursorfreezed=!0,y.hasmoving=!0,y.rail.drag.hr){y.scroll.x=y.rail.drag.sx+(e.clientX-y.rail.drag.x),0>y.scroll.x&&(y.scroll.x=0);var t=y.scrollvaluemaxw;y.scroll.x>t&&(y.scroll.x=t)}else y.scroll.y=y.rail.drag.sy+(e.clientY-y.rail.drag.y),0>y.scroll.y&&(y.scroll.y=0),t=y.scrollvaluemax,y.scroll.y>t&&(y.scroll.y=t);return y.synched("mousemove",function(){y.rail.drag&&1==y.rail.drag.pt&&(y.showCursor(),y.rail.drag.hr?y.hasreversehr?y.doScrollLeft(y.scrollvaluemaxw-Math.round(y.scroll.x*y.scrollratio.x),y.opt.cursordragspeed):y.doScrollLeft(Math.round(y.scroll.x*y.scrollratio.x),y.opt.cursordragspeed):y.doScrollTop(Math.round(y.scroll.y*y.scrollratio.y),y.opt.cursordragspeed))}),y.cancelEvent(e)}}else y.checkarea=0},S.cantouch||y.opt.touchbehavior)y.onpreventclick=function(e){return y.preventclick?(y.preventclick.tg.onclick=y.preventclick.click,y.preventclick=!1,y.cancelEvent(e)):void 0},y.bind(y.win,"mousedown",y.ontouchstart),y.onclick=S.isios?!1:function(e){return y.lastmouseup?(y.lastmouseup=!1,y.cancelEvent(e)):!0},y.opt.grabcursorenabled&&S.cursorgrabvalue&&(y.css(y.ispage?y.doc:y.win,{cursor:S.cursorgrabvalue}),y.css(y.rail,{cursor:S.cursorgrabvalue}));else{var b=function(e){if(y.selectiondrag){if(e){var t=y.win.outerHeight();e=e.pageY-y.selectiondrag.top,e>0&&t>e&&(e=0),e>=t&&(e-=t),y.selectiondrag.df=e}0!=y.selectiondrag.df&&(y.doScrollBy(2*-Math.floor(y.selectiondrag.df/6)),y.debounced("doselectionscroll",function(){b()},50))}};y.hasTextSelected="getSelection"in document?function(){return 0<document.getSelection().rangeCount}:"selection"in document?function(){return"None"!=document.selection.type}:function(){return!1},y.onselectionstart=function(e){y.ispage||(y.selectiondrag=y.win.offset())},y.onselectionend=function(e){y.selectiondrag=!1},y.onselectiondrag=function(e){y.selectiondrag&&y.hasTextSelected()&&y.debounced("selectionscroll",function(){b(e)},250)}}S.hasw3ctouch?(y.css(y.rail,{"touch-action":"none"}),y.css(y.cursor,{"touch-action":"none"}),y.bind(y.win,"pointerdown",y.ontouchstart),y.bind(document,"pointerup",y.ontouchend),y.bind(document,"pointermove",y.ontouchmove)):S.hasmstouch?(y.css(y.rail,{"-ms-touch-action":"none"}),y.css(y.cursor,{"-ms-touch-action":"none"}),y.bind(y.win,"MSPointerDown",y.ontouchstart),y.bind(document,"MSPointerUp",y.ontouchend),y.bind(document,"MSPointerMove",y.ontouchmove),y.bind(y.cursor,"MSGestureHold",function(e){e.preventDefault()}),y.bind(y.cursor,"contextmenu",function(e){e.preventDefault()})):this.istouchcapable&&(y.bind(y.win,"touchstart",y.ontouchstart),y.bind(document,"touchend",y.ontouchend),y.bind(document,"touchcancel",y.ontouchend),y.bind(document,"touchmove",y.ontouchmove)),(y.opt.cursordragontouch||!S.cantouch&&!y.opt.touchbehavior)&&(y.rail.css({cursor:"default"}),y.railh&&y.railh.css({cursor:"default"}),y.jqbind(y.rail,"mouseenter",function(){return y.ispage||y.win.is(":visible")?(y.canshowonmouseevent&&y.showCursor(),void(y.rail.active=!0)):!1}),y.jqbind(y.rail,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.rail,"click",function(e){y.doRailClick(e,!1,!1)}),y.bind(y.rail,"dblclick",function(e){y.doRailClick(e,!0,!1)}),y.bind(y.cursor,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursor,"dblclick",function(e){y.cancelEvent(e)})),y.railh&&(y.jqbind(y.railh,"mouseenter",function(){return y.ispage||y.win.is(":visible")?(y.canshowonmouseevent&&y.showCursor(),void(y.rail.active=!0)):!1}),y.jqbind(y.railh,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}),y.opt.sensitiverail&&(y.bind(y.railh,"click",function(e){y.doRailClick(e,!1,!0)}),y.bind(y.railh,"dblclick",function(e){y.doRailClick(e,!0,!0)}),y.bind(y.cursorh,"click",function(e){y.cancelEvent(e)}),y.bind(y.cursorh,"dblclick",function(e){y.cancelEvent(e)})))),S.cantouch||y.opt.touchbehavior?(y.bind(S.hasmousecapture?y.win:document,"mouseup",y.ontouchend),y.bind(document,"mousemove",y.ontouchmove),y.onclick&&y.bind(document,"click",y.onclick),y.opt.cursordragontouch?(y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mouseup",y.onmouseup),y.cursorh&&y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.cursorh&&y.bind(y.cursorh,"mouseup",y.onmouseup)):(y.bind(y.rail,"mousedown",function(e){e.preventDefault()}),y.railh&&y.bind(y.railh,"mousedown",function(e){e.preventDefault()}))):(y.bind(S.hasmousecapture?y.win:document,"mouseup",y.onmouseup),y.bind(document,"mousemove",y.onmousemove),y.onclick&&y.bind(document,"click",y.onclick),y.bind(y.cursor,"mousedown",y.onmousedown),y.bind(y.cursor,"mouseup",y.onmouseup),y.railh&&(y.bind(y.cursorh,"mousedown",function(e){y.onmousedown(e,!0)}),y.bind(y.cursorh,"mouseup",y.onmouseup)),!y.ispage&&y.opt.enablescrollonselection&&(y.bind(y.win[0],"mousedown",y.onselectionstart),y.bind(document,"mouseup",y.onselectionend),y.bind(y.cursor,"mouseup",y.onselectionend),y.cursorh&&y.bind(y.cursorh,"mouseup",y.onselectionend),y.bind(document,"mousemove",y.onselectiondrag)),y.zoom&&(y.jqbind(y.zoom,"mouseenter",function(){y.canshowonmouseevent&&y.showCursor(),y.rail.active=!0}),y.jqbind(y.zoom,"mouseleave",function(){y.rail.active=!1,y.rail.drag||y.hideCursor()}))),y.opt.enablemousewheel&&(y.isiframe||y.mousewheel(S.isie&&y.ispage?document:y.win,y.onmousewheel),y.mousewheel(y.rail,y.onmousewheel),y.railh&&y.mousewheel(y.railh,y.onmousewheelhr)),y.ispage||S.cantouch||/HTML|^BODY/.test(y.win[0].nodeName)||(y.win.attr("tabindex")||y.win.attr({tabindex:n++}),y.jqbind(y.win,"focus",function(e){t=y.getTarget(e).id||!0,y.hasfocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"blur",function(e){t=!1,y.hasfocus=!1}),y.jqbind(y.win,"mouseenter",function(e){o=y.getTarget(e).id||!0,y.hasmousefocus=!0,y.canshowonmouseevent&&y.noticeCursor()}),y.jqbind(y.win,"mouseleave",function(){o=!1,y.hasmousefocus=!1,y.rail.drag||y.hideCursor()}))}if(y.onkeypress=function(n){if(y.railslocked&&0==y.page.maxh)return!0;n=n?n:window.e;var i=y.getTarget(n);if(i&&/INPUT|TEXTAREA|SELECT|OPTION/.test(i.nodeName)&&(!i.getAttribute("type")&&!i.type||!/submit|button|cancel/i.tp)||e(i).attr("contenteditable"))return!0;if(y.hasfocus||y.hasmousefocus&&!t||y.ispage&&!t&&!o){if(i=n.keyCode,y.railslocked&&27!=i)return y.cancelEvent(n);var r=n.ctrlKey||!1,s=n.shiftKey||!1,a=!1;switch(i){case 38:case 63233:y.doScrollBy(72),a=!0;break;case 40:case 63235:y.doScrollBy(-72),a=!0;break;case 37:case 63232:y.railh&&(r?y.doScrollLeft(0):y.doScrollLeftBy(72),a=!0);break;case 39:case 63234:y.railh&&(r?y.doScrollLeft(y.page.maxw):y.doScrollLeftBy(-72),a=!0);break;case 33:case 63276:y.doScrollBy(y.view.h),a=!0;break;case 34:case 63277:y.doScrollBy(-y.view.h),a=!0;break;case 36:case 63273:y.railh&&r?y.doScrollPos(0,0):y.doScrollTo(0),a=!0;break;case 35:case 63275:y.railh&&r?y.doScrollPos(y.page.maxw,y.page.maxh):y.doScrollTo(y.page.maxh),a=!0;break;case 32:y.opt.spacebarenabled&&(s?y.doScrollBy(y.view.h):y.doScrollBy(-y.view.h),a=!0);break;case 27:y.zoomactive&&(y.doZoom(),a=!0)}if(a)return y.cancelEvent(n)}},y.opt.enablekeyboard&&y.bind(document,S.isopera&&!S.isopera12?"keypress":"keydown",y.onkeypress),y.bind(document,"keydown",function(e){e.ctrlKey&&(y.wheelprevented=!0)}),y.bind(document,"keyup",function(e){e.ctrlKey||(y.wheelprevented=!1)}),y.bind(window,"blur",function(e){y.wheelprevented=!1}),y.bind(window,"resize",y.lazyResize),y.bind(window,"orientationchange",y.lazyResize),y.bind(window,"load",y.lazyResize),S.ischrome&&!y.ispage&&!y.haswrapper){var w=y.win.attr("style"),c=parseFloat(y.win.css("width"))+1;y.win.css("width",c),y.synched("chromefix",function(){y.win.attr("style",w)})}y.onAttributeChange=function(e){y.lazyResize(y.isieold?250:30)},y.isie11||!1===u||(y.observerbody=new u(function(t){return t.forEach(function(t){return"attributes"==t.type?e("body").hasClass("modal-open")&&e("body").hasClass("modal-dialog")&&!e.contains(e(".modal-dialog")[0],y.doc[0])?y.hide():y.show():void 0}),document.body.scrollHeight!=y.page.maxh?y.lazyResize(30):void 0}),y.observerbody.observe(document.body,{childList:!0,subtree:!0,characterData:!1,attributes:!0,attributeFilter:["class"]})),y.ispage||y.haswrapper||(!1!==u?(y.observer=new u(function(e){e.forEach(y.onAttributeChange)}),y.observer.observe(y.win[0],{childList:!0,characterData:!1,attributes:!0,subtree:!1}),y.observerremover=new u(function(e){e.forEach(function(e){if(0<e.removedNodes.length)for(var t in e.removedNodes)if(y&&e.removedNodes[t]==y.win[0])return y.remove()})}),y.observerremover.observe(y.win[0].parentNode,{childList:!0,characterData:!1,attributes:!1,subtree:!1})):(y.bind(y.win,S.isie&&!S.isie9?"propertychange":"DOMAttrModified",y.onAttributeChange),S.isie9&&y.win[0].attachEvent("onpropertychange",y.onAttributeChange),y.bind(y.win,"DOMNodeRemoved",function(e){e.target==y.win[0]&&y.remove()}))),!y.ispage&&y.opt.boxzoom&&y.bind(window,"resize",y.resizeZoom),y.istextarea&&(y.bind(y.win,"keydown",y.lazyResize),y.bind(y.win,"mouseup",y.lazyResize)),y.lazyResize(30)}if("IFRAME"==this.doc[0].nodeName){var M=function(){y.iframexd=!1;var t;try{t="contentDocument"in this?this.contentDocument:this.contentWindow.document}catch(o){y.iframexd=!0,t=!1}if(y.iframexd)return"console"in window&&console.log("NiceScroll error: policy restriced iframe"),!0;if(y.forcescreen=!0,y.isiframe&&(y.iframe={doc:e(t),html:y.doc.contents().find("html")[0],body:y.doc.contents().find("body")[0]},y.getContentSize=function(){return{w:Math.max(y.iframe.html.scrollWidth,y.iframe.body.scrollWidth),h:Math.max(y.iframe.html.scrollHeight,y.iframe.body.scrollHeight)}},y.docscroll=e(y.iframe.body)),!S.isios&&y.opt.iframeautoresize&&!y.isiframe){y.win.scrollTop(0),y.doc.height("");var n=Math.max(t.getElementsByTagName("html")[0].scrollHeight,t.body.scrollHeight);y.doc.height(n)}y.lazyResize(30),S.isie7&&y.css(e(y.iframe.html),i),y.css(e(y.iframe.body),i),S.isios&&y.haswrapper&&y.css(e(t.body),{"-webkit-transform":"translate3d(0,0,0)"}),"contentWindow"in this?y.bind(this.contentWindow,"scroll",y.onscroll):y.bind(t,"scroll",y.onscroll),y.opt.enablemousewheel&&y.mousewheel(t,y.onmousewheel),y.opt.enablekeyboard&&y.bind(t,S.isopera?"keypress":"keydown",y.onkeypress),(S.cantouch||y.opt.touchbehavior)&&(y.bind(t,"mousedown",y.ontouchstart),y.bind(t,"mousemove",function(e){return y.ontouchmove(e,!0)}),y.opt.grabcursorenabled&&S.cursorgrabvalue&&y.css(e(t.body),{cursor:S.cursorgrabvalue})),y.bind(t,"mouseup",y.ontouchend),y.zoom&&(y.opt.dblclickzoom&&y.bind(t,"dblclick",y.doZoom),y.ongesturezoom&&y.bind(t,"gestureend",y.ongesturezoom))};this.doc[0].readyState&&"complete"==this.doc[0].readyState&&setTimeout(function(){M.call(y.doc[0],!1)},500),y.bind(this.doc,"load",M)}},this.showCursor=function(e,t){if(y.cursortimeout&&(clearTimeout(y.cursortimeout),y.cursortimeout=0),y.rail){if(y.autohidedom&&(y.autohidedom.stop().css({opacity:y.opt.cursoropacitymax}),y.cursoractive=!0),y.rail.drag&&1==y.rail.drag.pt||(void 0!==e&&!1!==e&&(y.scroll.y=Math.round(1*e/y.scrollratio.y)),void 0!==t&&(y.scroll.x=Math.round(1*t/y.scrollratio.x))),y.cursor.css({height:y.cursorheight,top:y.scroll.y}),y.cursorh){var o=y.hasreversehr?y.scrollvaluemaxw-y.scroll.x:y.scroll.x;!y.rail.align&&y.rail.visibility?y.cursorh.css({width:y.cursorwidth,left:o+y.rail.width}):y.cursorh.css({width:y.cursorwidth,left:o}),y.cursoractive=!0}y.zoom&&y.zoom.stop().css({opacity:y.opt.cursoropacitymax})}},this.hideCursor=function(e){y.cursortimeout||!y.rail||!y.autohidedom||y.hasmousefocus&&"leave"==y.opt.autohidemode||(y.cursortimeout=setTimeout(function(){y.rail.active&&y.showonmouseevent||(y.autohidedom.stop().animate({opacity:y.opt.cursoropacitymin}),y.zoom&&y.zoom.stop().animate({opacity:y.opt.cursoropacitymin}),y.cursoractive=!1),y.cursortimeout=0},e||y.opt.hidecursordelay))},this.noticeCursor=function(e,t,o){y.showCursor(t,o),y.rail.active||y.hideCursor(e)},this.getContentSize=y.ispage?function(){return{w:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth),h:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight)}}:y.haswrapper?function(){return{w:y.doc.outerWidth()+parseInt(y.win.css("paddingLeft"))+parseInt(y.win.css("paddingRight")),h:y.doc.outerHeight()+parseInt(y.win.css("paddingTop"))+parseInt(y.win.css("paddingBottom"))}}:function(){return{w:y.docscroll[0].scrollWidth,h:y.docscroll[0].scrollHeight}},this.onResize=function(e,t){if(!y||!y.win)return!1;if(!y.haswrapper&&!y.ispage){if("none"==y.win.css("display"))return y.visibility&&y.hideRail().hideRailHr(),!1;y.hidden||y.visibility||y.showRail().showRailHr()}var o=y.page.maxh,n=y.page.maxw,i=y.view.h,r=y.view.w;if(y.view={w:y.ispage?y.win.width():parseInt(y.win[0].clientWidth),h:y.ispage?y.win.height():parseInt(y.win[0].clientHeight)},y.page=t?t:y.getContentSize(),y.page.maxh=Math.max(0,y.page.h-y.view.h),y.page.maxw=Math.max(0,y.page.w-y.view.w),y.page.maxh==o&&y.page.maxw==n&&y.view.w==r&&y.view.h==i){if(y.ispage)return y;if(o=y.win.offset(),y.lastposition&&(n=y.lastposition,n.top==o.top&&n.left==o.left))return y;y.lastposition=o}return 0==y.page.maxh?(y.hideRail(),y.scrollvaluemax=0,y.scroll.y=0,y.scrollratio.y=0,y.cursorheight=0,y.setScrollTop(0),y.rail&&(y.rail.scrollable=!1)):(y.page.maxh-=y.opt.railpadding.top+y.opt.railpadding.bottom,y.rail.scrollable=!0),0==y.page.maxw?(y.hideRailHr(),y.scrollvaluemaxw=0,y.scroll.x=0,y.scrollratio.x=0,y.cursorwidth=0,y.setScrollLeft(0),y.railh&&(y.railh.scrollable=!1)):(y.page.maxw-=y.opt.railpadding.left+y.opt.railpadding.right,y.railh&&(y.railh.scrollable=y.opt.horizrailenabled)),y.railslocked=y.locked||0==y.page.maxh&&0==y.page.maxw,y.railslocked?(y.ispage||y.updateScrollBar(y.view),!1):(y.hidden||y.visibility?!y.railh||y.hidden||y.railh.visibility||y.showRailHr():y.showRail().showRailHr(),y.istextarea&&y.win.css("resize")&&"none"!=y.win.css("resize")&&(y.view.h-=20),y.cursorheight=Math.min(y.view.h,Math.round(y.view.h/y.page.h*y.view.h)),y.cursorheight=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorheight),y.cursorwidth=Math.min(y.view.w,Math.round(y.view.w/y.page.w*y.view.w)),y.cursorwidth=y.opt.cursorfixedheight?y.opt.cursorfixedheight:Math.max(y.opt.cursorminheight,y.cursorwidth),y.scrollvaluemax=y.view.h-y.cursorheight-y.cursor.hborder-(y.opt.railpadding.top+y.opt.railpadding.bottom),y.railh&&(y.railh.width=0<y.page.maxh?y.view.w-y.rail.width:y.view.w,y.scrollvaluemaxw=y.railh.width-y.cursorwidth-y.cursorh.wborder-(y.opt.railpadding.left+y.opt.railpadding.right)),y.ispage||y.updateScrollBar(y.view),y.scrollratio={x:y.page.maxw/y.scrollvaluemaxw,y:y.page.maxh/y.scrollvaluemax},y.getScrollTop()>y.page.maxh?y.doScrollTop(y.page.maxh):(y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x)),y.cursoractive&&y.noticeCursor()),y.scroll.y&&0==y.getScrollTop()&&y.doScrollTo(Math.floor(y.scroll.y*y.scrollratio.y)),y)},this.resize=y.onResize,this.hlazyresize=0,this.lazyResize=function(e){return y.haswrapper||y.hide(),y.hlazyresize&&clearTimeout(y.hlazyresize),y.hlazyresize=setTimeout(function(){y&&y.show().resize()},240),y},this.jqbind=function(t,o,n){y.events.push({e:t,n:o,f:n,q:!0}),e(t).bind(o,n)},this.mousewheel=function(e,t,o){if(e="jquery"in e?e[0]:e,"onwheel"in document.createElement("div"))y._bind(e,"wheel",t,o||!1);else{var n=void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll";v(e,n,t,o||!1),"DOMMouseScroll"==n&&v(e,"MozMousePixelScroll",t,o||!1)}},S.haseventlistener?(this.bind=function(e,t,o,n){y._bind("jquery"in e?e[0]:e,t,o,n||!1)},this._bind=function(e,t,o,n){y.events.push({e:e,n:t,f:o,b:n,q:!1}),e.addEventListener(t,o,n||!1)},this.cancelEvent=function(e){return e?(e=e.original?e.original:e,e.cancelable&&e.preventDefault(),e.stopPropagation(),e.preventManipulation&&e.preventManipulation(),!1):!1},this.stopPropagation=function(e){return e?(e=e.original?e.original:e,e.stopPropagation(),!1):!1},this._unbind=function(e,t,o,n){e.removeEventListener(t,o,n)}):(this.bind=function(e,t,o,n){var i="jquery"in e?e[0]:e;y._bind(i,t,function(e){return(e=e||window.event||!1)&&e.srcElement&&(e.target=e.srcElement),"pageY"in e||(e.pageX=e.clientX+document.documentElement.scrollLeft,e.pageY=e.clientY+document.documentElement.scrollTop),!1===o.call(i,e)||!1===n?y.cancelEvent(e):!0})},this._bind=function(e,t,o,n){y.events.push({e:e,n:t,f:o,b:n,q:!1}),e.attachEvent?e.attachEvent("on"+t,o):e["on"+t]=o},this.cancelEvent=function(e){return(e=window.event||!1)?(e.cancelBubble=!0,e.cancel=!0,e.returnValue=!1):!1},this.stopPropagation=function(e){return(e=window.event||!1)?(e.cancelBubble=!0,!1):!1},this._unbind=function(e,t,o,n){e.detachEvent?e.detachEvent("on"+t,o):e["on"+t]=!1}),this.unbindAll=function(){for(var e=0;e<y.events.length;e++){var t=y.events[e];t.q?t.e.unbind(t.n,t.f):y._unbind(t.e,t.n,t.f,t.b)}},this.showRail=function(){return 0==y.page.maxh||!y.ispage&&"none"==y.win.css("display")||(y.visibility=!0,y.rail.visibility=!0,y.rail.css("display","block")),y},this.showRailHr=function(){return y.railh?(0==y.page.maxw||!y.ispage&&"none"==y.win.css("display")||(y.railh.visibility=!0,y.railh.css("display","block")),y):y},this.hideRail=function(){return y.visibility=!1,y.rail.visibility=!1,y.rail.css("display","none"),y},this.hideRailHr=function(){return y.railh?(y.railh.visibility=!1,y.railh.css("display","none"),y):y},this.show=function(){return y.hidden=!1,y.railslocked=!1,y.showRail().showRailHr()},this.hide=function(){return y.hidden=!0,y.railslocked=!0,y.hideRail().hideRailHr()},this.toggle=function(){return y.hidden?y.show():y.hide()},this.remove=function(){y.stop(),y.cursortimeout&&clearTimeout(y.cursortimeout);for(var t in y.delaylist)y.delaylist[t]&&c(y.delaylist[t].h);for(y.doZoomOut(),y.unbindAll(),S.isie9&&y.win[0].detachEvent("onpropertychange",y.onAttributeChange),!1!==y.observer&&y.observer.disconnect(),!1!==y.observerremover&&y.observerremover.disconnect(),!1!==y.observerbody&&y.observerbody.disconnect(),y.events=null,y.cursor&&y.cursor.remove(),y.cursorh&&y.cursorh.remove(),y.rail&&y.rail.remove(),y.railh&&y.railh.remove(),y.zoom&&y.zoom.remove(),t=0;t<y.saved.css.length;t++){var o=y.saved.css[t];o[0].css(o[1],void 0===o[2]?"":o[2])}y.saved=!1,y.me.data("__nicescroll","");var n=e.nicescroll;n.each(function(e){if(this&&this.id===y.id){delete n[e];for(var t=++e;t<n.length;t++,e++)n[e]=n[t];n.length--,n.length&&delete n[n.length]}});for(var i in y)y[i]=null,delete y[i];y=null},this.scrollstart=function(e){return this.onscrollstart=e,y},this.scrollend=function(e){return this.onscrollend=e,y},this.scrollcancel=function(e){return this.onscrollcancel=e,y},this.zoomin=function(e){return this.onzoomin=e,y},this.zoomout=function(e){return this.onzoomout=e,y},this.isScrollable=function(t){if(t=t.target?t.target:t,"OPTION"==t.nodeName)return!0;for(;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var o=e(t),o=o.css("overflowY")||o.css("overflowX")||o.css("overflow")||"";if(/scroll|auto/.test(o))return t.clientHeight!=t.scrollHeight;t=t.parentNode?t.parentNode:!1}return!1},this.getViewport=function(t){for(t=t&&t.parentNode?t.parentNode:!1;t&&1==t.nodeType&&!/^BODY|HTML/.test(t.nodeName);){var o=e(t);if(/fixed|absolute/.test(o.css("position")))return o;var n=o.css("overflowY")||o.css("overflowX")||o.css("overflow")||"";if(/scroll|auto/.test(n)&&t.clientHeight!=t.scrollHeight||0<o.getNiceScroll().length)return o;t=t.parentNode?t.parentNode:!1}return!1},this.triggerScrollEnd=function(){if(y.onscrollend){var e=y.getScrollLeft(),t=y.getScrollTop();y.onscrollend.call(y,{type:"scrollend",current:{x:e,y:t},end:{x:e,y:t}})}},this.onmousewheel=function(e){if(!y.wheelprevented){if(y.railslocked)return y.debounced("checkunlock",y.resize,250),!0;if(y.rail.drag)return y.cancelEvent(e);if("auto"==y.opt.oneaxismousemode&&0!=e.deltaX&&(y.opt.oneaxismousemode=!1),y.opt.oneaxismousemode&&0==e.deltaX&&!y.rail.scrollable)return y.railh&&y.railh.scrollable?y.onmousewheelhr(e):!0;var t=+new Date,o=!1;return y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),o=!0),y.checkarea=t,y.nativescrollingarea?!0:((e=b(e,!1,o))&&(y.checkarea=0),e)}},this.onmousewheelhr=function(e){if(!y.wheelprevented){if(y.railslocked||!y.railh.scrollable)return!0;if(y.rail.drag)return y.cancelEvent(e);var t=+new Date,o=!1;return y.opt.preservenativescrolling&&y.checkarea+600<t&&(y.nativescrollingarea=y.isScrollable(e),o=!0),y.checkarea=t,y.nativescrollingarea?!0:y.railslocked?y.cancelEvent(e):b(e,!0,o)}},this.stop=function(){return y.cancelScroll(),y.scrollmon&&y.scrollmon.stop(),y.cursorfreezed=!1,y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.noticeCursor(),y},this.getTransitionSpeed=function(e){return e=Math.min(Math.round(10*y.opt.scrollspeed),Math.round(e/20*y.opt.scrollspeed)),e>20?e:0},y.opt.smoothscroll?y.ishwscroll&&S.hastransition&&y.opt.usetransition&&y.opt.smoothscroll?(this.prepareTransition=function(e,t){var o=t?e>20?e:0:y.getTransitionSpeed(e),n=o?S.prefixstyle+"transform "+o+"ms ease-out":"";return y.lasttransitionstyle&&y.lasttransitionstyle==n||(y.lasttransitionstyle=n,y.doc.css(S.transitionstyle,n)),o},this.doScrollLeft=function(e,t){var o=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t,o){var n=y.getScrollTop(),i=y.getScrollLeft();return(0>(y.newscrolly-n)*(t-n)||0>(y.newscrollx-i)*(e-i))&&y.cancelScroll(),0==y.opt.bouncescroll&&(0>t?t=0:t>y.page.maxh&&(t=y.page.maxh),0>e?e=0:e>y.page.maxw&&(e=y.page.maxw)),y.scrollrunning&&e==y.newscrollx&&t==y.newscrolly?!1:(y.newscrolly=t,y.newscrollx=e,y.newscrollspeed=o||!1,y.timer?!1:void(y.timer=setTimeout(function(){var o=y.getScrollTop(),n=y.getScrollLeft(),i=Math.round(Math.sqrt(Math.pow(e-n,2)+Math.pow(t-o,2))),i=y.newscrollspeed&&1<y.newscrollspeed?y.newscrollspeed:y.getTransitionSpeed(i);y.newscrollspeed&&1>=y.newscrollspeed&&(i*=y.newscrollspeed),y.prepareTransition(i,!0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),i>0&&(!y.scrollrunning&&y.onscrollstart&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:n,y:o},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:i}),S.transitionend?y.scrollendtrapped||(y.scrollendtrapped=!0,y.bind(y.doc,S.transitionend,y.onScrollTransitionEnd,!1)):(y.scrollendtrapped&&clearTimeout(y.scrollendtrapped),y.scrollendtrapped=setTimeout(y.onScrollTransitionEnd,i)),y.timerscroll={bz:new I(o,y.newscrolly,i,0,0,.58,1),bh:new I(n,y.newscrollx,i,0,0,.58,1)
},y.cursorfreezed||(y.timerscroll.tm=setInterval(function(){y.showCursor(y.getScrollTop(),y.getScrollLeft())},60))),y.synched("doScroll-set",function(){y.timer=0,y.scrollendtrapped&&(y.scrollrunning=!0),y.setScrollTop(y.newscrolly),y.setScrollLeft(y.newscrollx),y.scrollendtrapped||y.onScrollTransitionEnd()})},50)))},this.cancelScroll=function(){if(!y.scrollendtrapped)return!0;var e=y.getScrollTop(),t=y.getScrollLeft();return y.scrollrunning=!1,S.transitionend||clearTimeout(S.transitionend),y.scrollendtrapped=!1,y._unbind(y.doc[0],S.transitionend,y.onScrollTransitionEnd),y.prepareTransition(0),y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1,y.cursorfreezed=!1,y.showCursor(e,t),y},this.onScrollTransitionEnd=function(){y.scrollendtrapped&&y._unbind(y.doc[0],S.transitionend,y.onScrollTransitionEnd),y.scrollendtrapped=!1,y.prepareTransition(0),y.timerscroll&&y.timerscroll.tm&&clearInterval(y.timerscroll.tm),y.timerscroll=!1;var e=y.getScrollTop(),t=y.getScrollLeft();return y.setScrollTop(e),y.railh&&y.setScrollLeft(t),y.noticeCursor(!1,e,t),y.cursorfreezed=!1,0>e?e=0:e>y.page.maxh&&(e=y.page.maxh),0>t?t=0:t>y.page.maxw&&(t=y.page.maxw),e!=y.newscrolly||t!=y.newscrollx?y.doScrollPos(t,e,y.opt.snapbackspeed):(y.onscrollend&&y.scrollrunning&&y.triggerScrollEnd(),void(y.scrollrunning=!1))}):(this.doScrollLeft=function(e,t){var o=y.scrollrunning?y.newscrolly:y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.scrollrunning?y.newscrollx:y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t,o){function n(){if(y.cancelAnimationFrame)return!0;if(y.scrollrunning=!0,u=1-u)return y.timer=a(n)||1;var e,t,o=0,i=t=y.getScrollTop();y.dst.ay?(i=y.bzscroll?y.dst.py+y.bzscroll.getNow()*y.dst.ay:y.newscrolly,e=i-t,(0>e&&i<y.newscrolly||e>0&&i>y.newscrolly)&&(i=y.newscrolly),y.setScrollTop(i),i==y.newscrolly&&(o=1)):o=1,t=e=y.getScrollLeft(),y.dst.ax?(t=y.bzscroll?y.dst.px+y.bzscroll.getNow()*y.dst.ax:y.newscrollx,e=t-e,(0>e&&t<y.newscrollx||e>0&&t>y.newscrollx)&&(t=y.newscrollx),y.setScrollLeft(t),t==y.newscrollx&&(o+=1)):o+=1,2==o?(y.timer=0,y.cursorfreezed=!1,y.bzscroll=!1,y.scrollrunning=!1,0>i?i=0:i>y.page.maxh&&(i=Math.max(0,y.page.maxh)),0>t?t=0:t>y.page.maxw&&(t=y.page.maxw),t!=y.newscrollx||i!=y.newscrolly?y.doScrollPos(t,i):y.onscrollend&&y.triggerScrollEnd()):y.timer=a(n)||1}if(t=void 0===t||!1===t?y.getScrollTop(!0):t,y.timer&&y.newscrolly==t&&y.newscrollx==e)return!0;y.timer&&c(y.timer),y.timer=0;var i=y.getScrollTop(),r=y.getScrollLeft();(0>(y.newscrolly-i)*(t-i)||0>(y.newscrollx-r)*(e-r))&&y.cancelScroll(),y.newscrolly=t,y.newscrollx=e,y.bouncescroll&&y.rail.visibility||(0>y.newscrolly?y.newscrolly=0:y.newscrolly>y.page.maxh&&(y.newscrolly=y.page.maxh)),y.bouncescroll&&y.railh.visibility||(0>y.newscrollx?y.newscrollx=0:y.newscrollx>y.page.maxw&&(y.newscrollx=y.page.maxw)),y.dst={},y.dst.x=e-r,y.dst.y=t-i,y.dst.px=r,y.dst.py=i;var s=Math.round(Math.sqrt(Math.pow(y.dst.x,2)+Math.pow(y.dst.y,2)));y.dst.ax=y.dst.x/s,y.dst.ay=y.dst.y/s;var l=0,d=s;if(0==y.dst.x?(l=i,d=t,y.dst.ay=1,y.dst.py=0):0==y.dst.y&&(l=r,d=e,y.dst.ax=1,y.dst.px=0),s=y.getTransitionSpeed(s),o&&1>=o&&(s*=o),y.bzscroll=s>0?y.bzscroll?y.bzscroll.update(d,s):new I(l,d,s,0,1,0,1):!1,!y.timer){(i==y.page.maxh&&t>=y.page.maxh||r==y.page.maxw&&e>=y.page.maxw)&&y.checkContentSize();var u=1;y.cancelAnimationFrame=!1,y.timer=1,y.onscrollstart&&!y.scrollrunning&&y.onscrollstart.call(y,{type:"scrollstart",current:{x:r,y:i},request:{x:e,y:t},end:{x:y.newscrollx,y:y.newscrolly},speed:s}),n(),(i==y.page.maxh&&t>=i||r==y.page.maxw&&e>=r)&&y.checkContentSize(),y.noticeCursor()}},this.cancelScroll=function(){return y.timer&&c(y.timer),y.timer=0,y.bzscroll=!1,y.scrollrunning=!1,y}):(this.doScrollLeft=function(e,t){var o=y.getScrollTop();y.doScrollPos(e,o,t)},this.doScrollTop=function(e,t){var o=y.getScrollLeft();y.doScrollPos(o,e,t)},this.doScrollPos=function(e,t,o){var n=e>y.page.maxw?y.page.maxw:e;0>n&&(n=0);var i=t>y.page.maxh?y.page.maxh:t;0>i&&(i=0),y.synched("scroll",function(){y.setScrollTop(i),y.setScrollLeft(n)})},this.cancelScroll=function(){}),this.doScrollBy=function(e,t){var o=0,o=t?Math.floor((y.scroll.y-e)*y.scrollratio.y):(y.timer?y.newscrolly:y.getScrollTop(!0))-e;if(y.bouncescroll){var n=Math.round(y.view.h/2);-n>o?o=-n:o>y.page.maxh+n&&(o=y.page.maxh+n)}return y.cursorfreezed=!1,n=y.getScrollTop(!0),0>o&&0>=n?y.noticeCursor():o>y.page.maxh&&n>=y.page.maxh?(y.checkContentSize(),y.noticeCursor()):void y.doScrollTop(o)},this.doScrollLeftBy=function(e,t){var o=0,o=t?Math.floor((y.scroll.x-e)*y.scrollratio.x):(y.timer?y.newscrollx:y.getScrollLeft(!0))-e;if(y.bouncescroll){var n=Math.round(y.view.w/2);-n>o?o=-n:o>y.page.maxw+n&&(o=y.page.maxw+n)}return y.cursorfreezed=!1,n=y.getScrollLeft(!0),0>o&&0>=n||o>y.page.maxw&&n>=y.page.maxw?y.noticeCursor():void y.doScrollLeft(o)},this.doScrollTo=function(e,t){y.cursorfreezed=!1,y.doScrollTop(e)},this.checkContentSize=function(){var e=y.getContentSize();e.h==y.page.h&&e.w==y.page.w||y.resize(!1,e)},y.onscroll=function(e){y.rail.drag||y.cursorfreezed||y.synched("scroll",function(){y.scroll.y=Math.round(y.getScrollTop()*(1/y.scrollratio.y)),y.railh&&(y.scroll.x=Math.round(y.getScrollLeft()*(1/y.scrollratio.x))),y.noticeCursor()})},y.bind(y.docscroll,"scroll",y.onscroll),this.doZoomIn=function(t){if(!y.zoomactive){y.zoomactive=!0,y.zoomrestore={style:{}};var o,n="position top left zIndex backgroundColor marginTop marginBottom marginLeft marginRight".split(" "),i=y.win[0].style;for(o in n){var s=n[o];y.zoomrestore.style[s]=void 0!==i[s]?i[s]:""}return y.zoomrestore.style.width=y.win.css("width"),y.zoomrestore.style.height=y.win.css("height"),y.zoomrestore.padding={w:y.win.outerWidth()-y.win.width(),h:y.win.outerHeight()-y.win.height()},S.isios4&&(y.zoomrestore.scrollTop=e(window).scrollTop(),e(window).scrollTop(0)),y.win.css({position:S.isios4?"absolute":"fixed",top:0,left:0,zIndex:r+100,margin:0}),n=y.win.css("backgroundColor"),(""==n||/transparent|rgba\(0, 0, 0, 0\)|rgba\(0,0,0,0\)/.test(n))&&y.win.css("backgroundColor","#fff"),y.rail.css({zIndex:r+101}),y.zoom.css({zIndex:r+102}),y.zoom.css("backgroundPosition","0px -18px"),y.resizeZoom(),y.onzoomin&&y.onzoomin.call(y),y.cancelEvent(t)}},this.doZoomOut=function(t){return y.zoomactive?(y.zoomactive=!1,y.win.css("margin",""),y.win.css(y.zoomrestore.style),S.isios4&&e(window).scrollTop(y.zoomrestore.scrollTop),y.rail.css({"z-index":y.zindex}),y.zoom.css({"z-index":y.zindex}),y.zoomrestore=!1,y.zoom.css("backgroundPosition","0px 0px"),y.onResize(),y.onzoomout&&y.onzoomout.call(y),y.cancelEvent(t)):void 0},this.doZoom=function(e){return y.zoomactive?y.doZoomOut(e):y.doZoomIn(e)},this.resizeZoom=function(){if(y.zoomactive){var t=y.getScrollTop();y.win.css({width:e(window).width()-y.zoomrestore.padding.w+"px",height:e(window).height()-y.zoomrestore.padding.h+"px"}),y.onResize(),y.setScrollTop(Math.min(y.page.maxh,t))}},this.init(),e.nicescroll.push(this)},f=function(e){var t=this;this.nc=e,this.steptime=this.lasttime=this.speedy=this.speedx=this.lasty=this.lastx=0,this.snapy=this.snapx=!1,this.demuly=this.demulx=0,this.lastscrolly=this.lastscrollx=-1,this.timer=this.chky=this.chkx=0,this.time=function(){return+new Date},this.reset=function(e,o){t.stop();var n=t.time();t.steptime=0,t.lasttime=n,t.speedx=0,t.speedy=0,t.lastx=e,t.lasty=o,t.lastscrollx=-1,t.lastscrolly=-1},this.update=function(e,o){var n=t.time();t.steptime=n-t.lasttime,t.lasttime=n;var n=o-t.lasty,i=e-t.lastx,r=t.nc.getScrollTop(),s=t.nc.getScrollLeft(),r=r+n,s=s+i;t.snapx=0>s||s>t.nc.page.maxw,t.snapy=0>r||r>t.nc.page.maxh,t.speedx=i,t.speedy=n,t.lastx=e,t.lasty=o},this.stop=function(){t.nc.unsynched("domomentum2d"),t.timer&&clearTimeout(t.timer),t.timer=0,t.lastscrollx=-1,t.lastscrolly=-1},this.doSnapy=function(e,o){var n=!1;0>o?(o=0,n=!0):o>t.nc.page.maxh&&(o=t.nc.page.maxh,n=!0),0>e?(e=0,n=!0):e>t.nc.page.maxw&&(e=t.nc.page.maxw,n=!0),n?t.nc.doScrollPos(e,o,t.nc.opt.snapbackspeed):t.nc.triggerScrollEnd()},this.doMomentum=function(e){var o=t.time(),n=e?o+e:t.lasttime;e=t.nc.getScrollLeft();var i=t.nc.getScrollTop(),r=t.nc.page.maxh,s=t.nc.page.maxw;if(t.speedx=s>0?Math.min(60,t.speedx):0,t.speedy=r>0?Math.min(60,t.speedy):0,n=n&&60>=o-n,(0>i||i>r||0>e||e>s)&&(n=!1),e=t.speedx&&n?t.speedx:!1,t.speedy&&n&&t.speedy||e){var a=Math.max(16,t.steptime);a>50&&(e=a/50,t.speedx*=e,t.speedy*=e,a=50),t.demulxy=0,t.lastscrollx=t.nc.getScrollLeft(),t.chkx=t.lastscrollx,t.lastscrolly=t.nc.getScrollTop(),t.chky=t.lastscrolly;var c=t.lastscrollx,l=t.lastscrolly,d=function(){var e=600<t.time()-o?.04:.02;t.speedx&&(c=Math.floor(t.lastscrollx-t.speedx*(1-t.demulxy)),t.lastscrollx=c,0>c||c>s)&&(e=.1),t.speedy&&(l=Math.floor(t.lastscrolly-t.speedy*(1-t.demulxy)),t.lastscrolly=l,0>l||l>r)&&(e=.1),t.demulxy=Math.min(1,t.demulxy+e),t.nc.synched("domomentum2d",function(){t.speedx&&(t.nc.getScrollLeft(),t.chkx=c,t.nc.setScrollLeft(c)),t.speedy&&(t.nc.getScrollTop(),t.chky=l,t.nc.setScrollTop(l)),t.timer||(t.nc.hideCursor(),t.doSnapy(c,l))}),1>t.demulxy?t.timer=setTimeout(d,a):(t.stop(),t.nc.hideCursor(),t.doSnapy(c,l))};d()}else t.doSnapy(t.nc.getScrollLeft(),t.nc.getScrollTop())}},v=e.fn.scrollTop;e.cssHooks.pageYOffset={get:function(t,o,n){return(o=e.data(t,"__nicescroll")||!1)&&o.ishwscroll?o.getScrollTop():v.call(t)},set:function(t,o){var n=e.data(t,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollTop(parseInt(o)):v.call(t,o),this}},e.fn.scrollTop=function(t){if(void 0===t){var o=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return o&&o.ishwscroll?o.getScrollTop():v.call(this)}return this.each(function(){var o=e.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollTop(parseInt(t)):v.call(e(this),t)})};var b=e.fn.scrollLeft;e.cssHooks.pageXOffset={get:function(t,o,n){return(o=e.data(t,"__nicescroll")||!1)&&o.ishwscroll?o.getScrollLeft():b.call(t)},set:function(t,o){var n=e.data(t,"__nicescroll")||!1;return n&&n.ishwscroll?n.setScrollLeft(parseInt(o)):b.call(t,o),this}},e.fn.scrollLeft=function(t){if(void 0===t){var o=this[0]?e.data(this[0],"__nicescroll")||!1:!1;return o&&o.ishwscroll?o.getScrollLeft():b.call(this)}return this.each(function(){var o=e.data(this,"__nicescroll")||!1;o&&o.ishwscroll?o.setScrollLeft(parseInt(t)):b.call(e(this),t)})};var y=function(t){var o=this;if(this.length=0,this.name="nicescrollarray",this.each=function(t){return e.each(o,t),o},this.push=function(e){o[o.length]=e,o.length++},this.eq=function(e){return o[e]},t)for(var n=0;n<t.length;n++){var i=e.data(t[n],"__nicescroll")||!1;i&&(this[this.length]=i,this.length++)}return this};!function(e,t,o){for(var n=0;n<t.length;n++)o(e,t[n])}(y.prototype,"show hide toggle onResize resize remove stop doScrollPos".split(" "),function(e,t){e[t]=function(){var e=arguments;return this.each(function(){this[t].apply(this,e)})}}),e.fn.getNiceScroll=function(t){return void 0===t?new y(this):this[t]&&e.data(this[t],"__nicescroll")||!1},e.expr[":"].nicescroll=function(t){return void 0!==e.data(t,"__nicescroll")},e.fn.niceScroll=function(t,o){void 0!==o||"object"!=typeof t||"jquery"in t||(o=t,t=!1),o=e.extend({},o);var n=new y;void 0===o&&(o={}),t&&(o.doc=e(t),o.win=e(this));var i=!("doc"in o);return i||"win"in o||(o.win=e(this)),this.each(function(){var t=e(this).data("__nicescroll")||!1;t||(o.doc=i?e(this):o.doc,t=new m(o,e(this)),e(this).data("__nicescroll",t)),n.push(t)}),1==n.length?n[0]:n},window.NiceScroll={getjQuery:function(){return e}},e.nicescroll||(e.nicescroll=new y,e.nicescroll.options=g)});var RongWebIMWidget;!function(e){var t;!function(e){angular.module("RongWebIMWidget.conversation",[])}(t=e.conversation||(e.conversation={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(e){angular.module("RongWebIMWidget.conversationlist",[])}(t=e.conversationlist||(e.conversationlist={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){angular.module("RongWebIMWidget",["RongWebIMWidget.conversation","RongWebIMWidget.conversationlist","Evaluate"])}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t=window.navigator.userAgent,o=function(){function e(){}return e.timeCompare=function(e,t){var o=e.toString(),n=t.toString();return o.substring(0,o.lastIndexOf(":"))==n.substring(0,n.lastIndexOf(":"))},e.cloneObject=function(t){if(!t)return null;var o;if("[object Array]"==Object.prototype.toString.call(t)){o=[];for(var n=t.length;n--;)o[n]=e.cloneObject(t[n]);return o}if("object"==typeof t){o={};for(var i in t)o[i]=t[i];return o}return t},e.checkType=function(e){var t=Object.prototype.toString.call(e);return t.substring(8,t.length-1).toLowerCase()},e.browser={version:(t.match(/.+(?:rv|it|ra|chrome|ie)[\/: ]([\d.]+)/)||[0,"0"])[1],safari:/webkit/.test(t),opera:/opera|opr/.test(t),msie:/msie|trident/.test(t)&&!/opera/.test(t),chrome:/chrome/.test(t),mozilla:/mozilla/.test(t)&&!/(compatible|webkit|like gecko)/.test(t)},e.escapeSymbol={escapeHtml:function(e){return e?(e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=e.replace(/"/g,"&quot;"),e=e.replace(/'/g,"&#039;")):""}},e.getFocus=function(t){if(t.focus(),t.createTextRange){var o=t.createTextRange();o.moveStart("character",t.value.length),o.collapse(!0),o.select()}else if(t.selectionStart)t.selectionStart=t.value.length;else if(window.getSelection&&t.lastChild){var n=window.getSelection(),i=document.createRange();e.browser.msie?i.setStart(t.lastChild,t.lastChild.length):i.setStart(t.firstChild,t.firstChild.length),n.removeAllRanges(),n.addRange(i)}},e.ImageHelper={getThumbnail:function(t,o,n){var i=document.createElement("canvas"),r=i.getContext("2d"),s=new Image;s.onload=function(){var e,a,c=s.width*s.height;if(c>o){var l=Math.sqrt(c/o);l=Math.ceil(100*l)/100,e=s.width/l,a=s.height/l}else e=s.width,a=s.height;i.width=e,i.height=a,r.drawImage(s,0,0,e,a);try{var d=i.toDataURL("image/jpeg",.5);d=d.substr(23),n(t,d)}catch(u){n(t,null)}},s.src=e.ImageHelper.getFullPath(t)},getFullPath:function(e){return window.URL=window.URL||window.webkitURL,window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(e):null}},e.CookieHelper={setCookie:function(e,t,o){if(o){var n=new Date;n.setDate(n.getDate()+o),document.cookie=e+"="+encodeURI(t)+";expires="+n.toUTCString()}else document.cookie=e+"="+encodeURI(t)+";"},getCookie:function(e){var t=document.cookie.indexOf(e+"=");if(-1!=t){var o=document.cookie.indexOf(";",t);return-1==o&&(o=document.cookie.length),decodeURI(document.cookie.substring(t+e.length+1,o))}return""},removeCookie:function(e){var t=this.getCookie(e);t&&this.setCookie(e,"con",-1)}},e}();e.Helper=o;var n=function(){function e(){}return e.isNotificationSupported=function(){return"function"==typeof Notification},e.requestPermission=function(){e.isNotificationSupported()&&Notification.requestPermission(function(e){})},e.onclick=function(e){},e.showNotification=function(t){if(!e.isNotificationSupported())return void console.log("the current browser does not support Notification API");if("granted"!==Notification.permission)return void console.log("the current page has not been granted for notification");if(e.desktopNotification){var o=t.title;delete t.title;var n=new Notification(o,t);n.onshow=function(){setTimeout(function(){n.close()},5e3)},n.onclick=function(){window.focus(),e.onclick(n),n.close()},n.onerror=function(){},n.onclose=function(){}}},e.desktopNotification=!0,e}();e.NotificationHelper=n;var i=function(){function e(){}return e.GetFactoryFor=function(e){var t=function(){for(var t=[],o=0;o<arguments.length;o++)t[o-0]=arguments[o];var n=Object.create(e.prototype);return n.constructor.apply(n,t),n};return t.$inject=e.$inject,t},e}();e.DirectiveFactory=i;var r=function(){function e(){}return e.instance=function(){return new e},e.prototype.link=function(e,t,o){o.ngSrc||o.$set("src",o.errSrc),t.bind("error",function(){o.src!=o.errSrc&&o.$set("src",o.errSrc)})},e}(),s=function(){function e(){this.restrict="A",this.require="?ngModel"}return e.prototype.link=function(e,t,o,n){function i(e){return e.replace(new RegExp("<[\\s\\S.]*?>","ig"),"")}function r(){var e=t.html();e=e.replace(/^<br>$/i,""),e=e.replace(/<br>/gi,"\n"),o.stripBr&&"<br>"==e&&(e=""),n.$setViewValue(e)}var s=t[0];e.$watch(function(){return n.$modelValue},function(e){document.activeElement!==s&&(""!==e&&e!==o.placeholder||(s.innerHTML=o.placeholder,s.style.color="#a9a9a9"))}),t.bind("focus",function(){s.innerHTML==o.placeholder&&(s.innerHTML=""),s.style.color=""}),t.bind("blur",function(){""===s.innerHTML&&(s.innerHTML=o.placeholder,s.style.color="#a9a9a9")}),n&&(t.bind("paste",function(e){var t=this;t.innerHTML;o&&clearTimeout(o);var o=setTimeout(function(){t.innerHTML=i(t.innerHTML),n.$setViewValue(t.innerHTML),o=null},50)}),n.$render=function(){t.html(n.$viewValue||"")},t.bind("keydown paste",r),t.bind("input",r))},e}(),a=function(){function e(){this.restrict="A",this.require="?ngModel",this.scope={fun:"&",ctrlenter:"=",content:"="}}return e.prototype.link=function(e,t,o,n){e.ctrlenter=e.ctrlenter||!1,t.bind("keypress",function(t){e.ctrlenter?(t.ctrlKey===!0&&13===t.keyCode||10===t.keyCode)&&(e.fun(),e.$parent.$apply(),t.preventDefault()):t.ctrlKey!==!1||t.shiftKey!==!1||13!==t.keyCode&&10!==t.keyCode?t.ctrlKey===!0&&13===t.keyCode||10===t.keyCode:(e.fun(),e.$parent.$apply(),t.preventDefault())})},e}();angular.module("RongWebIMWidget").directive("errSrc",r.instance).directive("contenteditableDire",i.GetFactoryFor(s)).directive("ctrlEnterKeys",i.GetFactoryFor(a)).filter("trustHtml",["$sce",function(e){return function(t){return e.trustAsHtml(t)}}]).filter("historyTime",["$filter",function(e){return function(t){var o=new Date;return t.toDateString()===o.toDateString()?e("date")(t,"HH:mm"):t.toDateString()===new Date(o.setTime(o.getTime()-1)).toDateString()?"昨天"+e("date")(t,"HH:mm"):e("date")(t,"yyyy-MM-dd HH:mm")}}])}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(t){var o="http://7xogjk.com1.z0.glb.clouddn.com/",n=function(){function t(t,n,i,r,s,a,c){function l(){c.getFileToken().then(function(e){n._uploadToken=e,d()})}function d(){g&&g.destroy(),g=Qiniu.uploader({runtimes:"html5,html4",browse_button:"upload-file",container:"funcPanel",drop_element:"inputMsg",max_file_size:"100mb",dragdrop:!0,chunk_size:"4mb",uptoken:n._uploadToken,domain:o,get_new_uptoken:!1,filters:{mime_types:[{title:"Image files",extensions:"jpg,gif,png,jpeg,bmp"}],prevent_duplicates:!1},multi_selection:!1,auto_start:!0,init:{FilesAdded:function(e,t){},BeforeUpload:function(e,t){},UploadProgress:function(e,t){},UploadComplete:function(){},FileUploaded:function(o,i,s){return t.conversation.targetId&&t.conversation.targetType?(s=s.replace(/'/g,'"'),s=JSON.parse(s),void RongIMLib.RongIMClient.getInstance().getFileUrl(RongIMLib.FileType.IMAGE,s.name,{onSuccess:function(o){e.Helper.ImageHelper.getThumbnail(i.getNative(),6e4,function(i,s){var a=RongIMLib.ImageMessage.obtain(s,o.downloadUrl),c=u.packDisplaySendMessage(a,e.MessageType.ImageMessage);RongIMLib.RongIMClient.getInstance().sendMessage(t.conversation.targetType,t.conversation.targetId,a,{onSuccess:function(){r.updateConversations().then(function(){})},onError:function(){}}),n._addHistoryMessages(e.Message.convert(c)),t.$apply(function(){t.scrollBar()}),l()})},onError:function(){}})):void alert("请先选择一个会话目标。")},Error:function(e,t,o){console.log(t),l()}}})}this.$scope=t,this.conversationServer=n,this.WebIMWidget=i,this.conversationListServer=r,this.widgetConfig=s,this.providerdata=a,this.RongIMSDKServer=c;var u=this;n.changeConversation=function(e){u.changeConversation(e)},n.handleMessage=function(e){u.handleMessage(e)},n._handleConnectSuccess=function(){l()},t.evaluate={type:1,showevaluate:!1,valid:!1,onConfirm:function(e){e&&(1==t.evaluate.type?c.evaluateHumanCustomService(n.current.targetId,e.stars,e.describe).then(function(){},function(){}):c.evaluateHumanCustomService(n.current.targetId,e.value,e.describe).then(function(){},function(){})),RongIMLib.RongIMClient.getInstance().stopCustomeService(n.current.targetId,{onSuccess:function(){},onError:function(){}}),u.closeState()},onCancle:function(){t.evaluate.showSelf=!1}},t._inputPanelState=e.EnumInputPanelType.person,t.$watch("showemoji",function(e,o){e!==o&&(t.emojiList&&0!=t.emojiList.length||(t.emojiList=RongIMLib.RongIMEmoji.emojis.slice(0,66)))}),document.addEventListener("click",function(e){t.showemoji&&-1==e.target.className.indexOf("iconfont-smile")&&t.$apply(function(){t.showemoji=!1})}),t.$watch("showSelf",function(e,t){e!==t&&(e&&n._uploadToken?d():g&&g.destroy())}),t.$watch("_inputPanelState",function(t,o){t!==o&&(t==e.EnumInputPanelType.person&&n._uploadToken?d():g&&g.destroy())}),t.$watch("conversation.messageContent",function(e,o){e!==o&&t.conversation&&RongIMLib.RongIMClient.getInstance().saveTextMessageDraft(+t.conversation.targetType,t.conversation.targetId,e)}),t.getHistory=function(){var o=t.conversation.targetType+"_"+t.conversation.targetId,i=n._cacheHistory[o];i.splice(0,i.length),n._getHistoryMessages(+t.conversation.targetType,t.conversation.targetId,20).then(function(t){t.has&&n._cacheHistory[o].unshift(new e.GetMoreMessagePanel)})},t.getMoreMessage=function(){var o=t.conversation.targetType+"_"+t.conversation.targetId;n._cacheHistory[o].shift(),n._cacheHistory[o].shift(),n._getHistoryMessages(+t.conversation.targetType,t.conversation.targetId,20).then(function(t){t.has&&n._cacheHistory[o].unshift(new e.GetMoreMessagePanel)})},t.switchPerson=function(){RongIMLib.RongIMClient.getInstance().switchToHumanMode(n.current.targetId,{onSuccess:function(){},onError:function(){}})},t.send=function(){if(!t.conversation.targetId||!t.conversation.targetType)return void alert("请先选择一个会话目标。");if(""!=t.conversation.messageContent){var o=RongIMLib.RongIMEmoji.symbolToEmoji(t.conversation.messageContent),i=RongIMLib.TextMessage.obtain(o),s=new RongIMLib.UserInfo(a.currentUserInfo.userId,a.currentUserInfo.name,a.currentUserInfo.portraitUri);i.user=s;try{RongIMLib.RongIMClient.getInstance().sendMessage(+t.conversation.targetType,t.conversation.targetId,i,{onSuccess:function(e){r.updateConversations().then(function(){})},onError:function(e){}})}catch(c){}var l=u.packDisplaySendMessage(i,e.MessageType.TextMessage),d=e.Message.convert(l);n._addHistoryMessages(d),t.scrollBar(),t.conversation.messageContent="";var g=document.getElementById("inputMsg");e.Helper.getFocus(g)}};var g;t.close=function(){if(i.onCloseBefore&&"function"==typeof i.onCloseBefore){i.onCloseBefore({close:function(o){n.current.targetType==e.EnumConversationType.CUSTOMER_SERVICE?t.evaluate.valid?t.evaluate.showSelf=!0:t.evaluate.onCancle():u.closeState()}})}else n.current.targetType==e.EnumConversationType.CUSTOMER_SERVICE?t.evaluate.valid?t.evaluate.showSelf=!0:t.evaluate.onCancle():u.closeState()},t.minimize=function(){i.display=!1}}return t.prototype.closeState=function(){var e=this;this.WebIMWidget.onClose&&"function"==typeof this.WebIMWidget.onClose&&setTimeout(function(){e.WebIMWidget.onClose(e.$scope.conversation)},1),this.widgetConfig.displayConversationList?this.$scope.showSelf=!1:this.WebIMWidget.display=!1,this.$scope.messageList=[],this.$scope.conversation=null,this.conversationServer.current=null},t.prototype.changeConversation=function(t){var o=this;if(o.widgetConfig.displayConversationList?o.$scope.showSelf=!0:(o.$scope.showSelf=!0,o.WebIMWidget.display=!0),!t||!t.targetId)return o.$scope.conversation={},o.$scope.messageList=[],o.conversationServer.current=null,void setTimeout(function(){o.$scope.$apply()});var n=t.targetType+"_"+t.targetId;t.targetType!=e.EnumConversationType.CUSTOMER_SERVICE||o.conversationServer.current&&o.conversationServer.current.targetId==t.targetId||o.RongIMSDKServer.startCustomService(t.targetId),o.conversationServer.current=t,o.$scope.conversation=t,o.$scope.conversation.messageContent=RongIMLib.RongIMClient.getInstance().getTextMessageDraft(t.targetType,t.targetId)||"",o.$scope.messageList=o.conversationServer._cacheHistory[n]=o.conversationServer._cacheHistory[n]||[],0==o.$scope.messageList.length?o.conversationServer._getHistoryMessages(t.targetType,t.targetId,3).then(function(t){o.$scope.messageList.length>0&&(o.$scope.messageList.unshift(new e.TimePanl(o.$scope.messageList[0].sentTime)),t.has&&o.$scope.messageList.unshift(new e.GetMoreMessagePanel),setTimeout(function(){o.$scope.$apply()}),o.$scope.scrollBar())}):(setTimeout(function(){o.$scope.$apply()}),o.$scope.scrollBar())},t.prototype.handleMessage=function(t){var o=this;if(o.$scope.conversation&&t.targetId==o.$scope.conversation.targetId&&t.conversationType==o.$scope.conversation.targetType){o.$scope.$apply();var n=null;switch(t.messageType){case e.MessageType.HandShakeResponseMessage:o.conversationServer._customService.type=t.content.data.serviceType,o.conversationServer._customService.companyName=t.content.data.companyName,o.conversationServer._customService.robotName=t.content.data.robotName,o.conversationServer._customService.robotIcon=t.content.data.robotIcon,o.conversationServer._customService.robotWelcome=t.content.data.robotWelcome,o.conversationServer._customService.humanWelcome=t.content.data.humanWelcome,o.conversationServer._customService.noOneOnlineTip=t.content.data.noOneOnlineTip,"1"==t.content.data.serviceType?(o.changeCustomerState(e.EnumInputPanelType.robot),t.content.data.robotWelcome&&(n=this.packReceiveMessage(RongIMLib.TextMessage.obtain(t.content.data.robotWelcome),e.MessageType.TextMessage))):"3"==t.content.data.serviceType?(t.content.data.robotWelcome&&(n=this.packReceiveMessage(RongIMLib.TextMessage.obtain(t.content.data.robotWelcome),e.MessageType.TextMessage)),o.changeCustomerState(e.EnumInputPanelType.robotSwitchPerson)):o.changeCustomerState(e.EnumInputPanelType.person),o.$scope.evaluate.valid=!1,o.$scope.evaluate.valid=!0;break;case e.MessageType.ChangeModeResponseMessage:switch(t.content.data.status){case 1:o.conversationServer._customService.human.name=t.content.data.name||"客服人员",o.conversationServer._customService.human.headimgurl=t.content.data.headimgurl,o.changeCustomerState(e.EnumInputPanelType.person);break;case 2:"2"==o.conversationServer._customService.type?o.changeCustomerState(e.EnumInputPanelType.person):"1"!=o.conversationServer._customService.type&&"3"!=o.conversationServer._customService.type||o.changeCustomerState(e.EnumInputPanelType.robotSwitchPerson);break;case 3:o.changeCustomerState(e.EnumInputPanelType.robot),n=this.packReceiveMessage(RongIMLib.InformationNotificationMessage.obtain("你被拉黑了"),e.MessageType.InformationNotificationMessage);break;case 4:o.changeCustomerState(e.EnumInputPanelType.person),n=o.packReceiveMessage(RongIMLib.InformationNotificationMessage.obtain("已经是人工了"),e.MessageType.InformationNotificationMessage)}break;case e.MessageType.TerminateMessage:0==t.content.code?(o.$scope.evaluate.valid=!0,o.$scope.close()):"1"==o.conversationServer._customService.type?o.changeCustomerState(e.EnumInputPanelType.robot):o.changeCustomerState(e.EnumInputPanelType.robotSwitchPerson);break;case e.MessageType.SuspendMessage:t.messageDirection==e.MessageDirection.SEND&&o.closeState();break;case e.MessageType.CustomerStatusUpdateMessage:switch(Number(t.content.serviceStatus)){case 1:"1"==o.conversationServer._customService.type?o.changeCustomerState(e.EnumInputPanelType.robot):o.changeCustomerState(e.EnumInputPanelType.robotSwitchPerson);break;case 2:o.changeCustomerState(e.EnumInputPanelType.person);break;case 3:o.changeCustomerState(e.EnumInputPanelType.notService)}}if(n){var i=e.Message.convert(n);o.addCustomService(i),o.conversationServer._addHistoryMessages(i)}o.addCustomService(t),setTimeout(function(){o.$scope.$apply(),o.$scope.scrollBar()},200)}},t.prototype.addCustomService=function(t){return t.content&&!t.content.userInfo?(t.conversationType==e.EnumConversationType.CUSTOMER_SERVICE&&t.content&&t.messageDirection==e.MessageDirection.RECEIVE?"1"==this.conversationServer._customService.currentType?t.content.userInfo={name:this.conversationServer._customService.human.name||"客服人员",portraitUri:this.conversationServer._customService.human.headimgurl||this.conversationServer._customService.robotIcon}:t.content.userInfo={name:this.conversationServer._customService.robotName,portraitUri:this.conversationServer._customService.robotIcon}:t.conversationType==e.EnumConversationType.CUSTOMER_SERVICE&&t.content&&t.messageDirection==e.MessageDirection.SEND&&(t.content.userInfo={name:"我",portraitUri:this.providerdata.currentUserInfo.portraitUri}),t):void 0},t.prototype.changeCustomerState=function(t){this.$scope._inputPanelState=t,t==e.EnumInputPanelType.person?(this.$scope.evaluate.type=1,this.conversationServer._customService.currentType="1",this.conversationServer.current.title=this.conversationServer._customService.human.name||"客服人员"):(this.$scope.evaluate.type=2,this.conversationServer._customService.currentType="2",this.conversationServer.current.title=this.conversationServer._customService.robotName)},t.prototype.packDisplaySendMessage=function(e,t){var o=new RongIMLib.Message,n=new RongIMLib.UserInfo(this.providerdata.currentUserInfo.userId,this.providerdata.currentUserInfo.name||"我",this.providerdata.currentUserInfo.portraitUri);return e.user=n,o.content=e,o.conversationType=this.$scope.conversation.targetType,o.targetId=this.$scope.conversation.targetId,o.senderUserId=this.providerdata.currentUserInfo.userId,o.messageDirection=RongIMLib.MessageDirection.SEND,o.sentTime=(new Date).getTime()-(RongIMLib.RongIMClient.getInstance().getDeltaTime()||0),o.messageType=t,o},t.prototype.packReceiveMessage=function(e,t){var o=new RongIMLib.Message,n=null;return e.userInfo=n,o.content=e,o.conversationType=this.$scope.conversation.targetType,o.targetId=this.$scope.conversation.targetId,o.senderUserId=this.$scope.conversation.targetId,o.messageDirection=RongIMLib.MessageDirection.RECEIVE,o.sentTime=(new Date).getTime()-(RongIMLib.RongIMClient.getInstance().getDeltaTime()||0),o.messageType=t,o},t.$inject=["$scope","ConversationServer","WebIMWidget","ConversationListServer","WidgetConfig","ProviderData","RongIMSDKServer"],t}();angular.module("RongWebIMWidget.conversation").controller("conversationController",n)}(t=e.conversation||(e.conversation={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(t){var o=e.DirectiveFactory.GetFactoryFor,n=function(){function e(e){this.conversationServer=e,this.restrict="E",this.templateUrl="./src/ts/conversation/conversation.tpl.html",this.controller="conversationController"}return e.prototype.link=function(e,t){window.jQuery&&window.jQuery.nicescroll&&$("#Messages").niceScroll({cursorcolor:"#0099ff",cursoropacitymax:1,touchbehavior:!0,cursorwidth:"8px",cursorborder:"0",cursorborderradius:"5px"}),e.scrollBar=function(){setTimeout(function(){var e=document.getElementById("Messages");e&&(e.scrollTop=e.scrollHeight)},0)}},e.$inject=["ConversationServer"],e}(),i=function(){function t(){this.restrict="E",this.scope={item:"=",content:"="},this.template='<div style="display:inline-block"></div>'}return t.prototype.link=function(t,o,n){o.find("div").append(t.item),o.on("click",function(){t.content.messageContent=t.content.messageContent||"",t.content.messageContent=t.content.messageContent.replace(/\n$/,""),t.content.messageContent=t.content.messageContent+t.item.children[0].getAttribute("name"),t.$parent.$apply();var o=document.getElementById("inputMsg");e.Helper.getFocus(o)})},t}(),r=function(){function e(){this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-text"><pre class="rongcloud-Message-entry" ng-bind-html="msg.content|trustHtml"><br></pre></div></div>'}return e.prototype.link=function(e,t,o){var n=/\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*/gi,i=[];e.msg.content=e.msg.content.replace(n,function(e){return i.push(e),"[email`"+(i.length-1)+"]"});var r=/(((ht|f)tp(s?))\:\/\/)?((25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9])\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[1-9]|0)\.(25[0-5]|2[0-4][0-9]|[0-1]{1}[0-9]{2}|[1-9]{1}[0-9]{1}|[0-9])|(www.|[a-zA-Z].)[a-zA-Z0-9\-\.]+\.(com|cn|edu|gov|mil|net|org|biz|info|name|museum|us|ca|uk|me|im))(\:[0-9]+)*(\/($|[a-zA-Z0-9\.\,\;\?\'\\\+&amp;%\$#\=~_\-]+))*/gi;
e.msg.content=e.msg.content.replace(r,function(e,t){return t?'<a target="_blank" href="'+e+'">'+e+"</a>":'<a target="_blank" href="//'+e+'">'+e+"</a>"});for(var s=0,a=i.length;a>s;s++)e.content=e.content.replace("[email`"+s+"]",'<a href="mailto:'+i[s]+'">'+i[s]+"<a>")},e}(),s=function(){function e(){this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-text"><pre class="rongcloud-Message-entry" style="">维护中 由于我们的服务商出现故障，融云官网及相关服务也受到影响，给各位用户带来的不便，还请谅解。  您可以通过 <a href="#">【官方微博】</a>了解</pre></div></div>'}return e}(),a=function(){function e(){this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-img"><span id="{{\'rebox_\'+$id}}"  class="rongcloud-Message-entry" style=""><a href="{{msg.imageUri}}" target="_black"><img ng-src="{{msg.content}}"  data-image="{{msg.imageUri}}" alt=""/></a></span></div></div>'}return e.prototype.link=function(e,t,o){var n=new Image;n.src=e.msg.imageUri,setTimeout(function(){window.jQuery&&window.jQuery.rebox&&$("#rebox_"+e.$id).rebox({selector:"a",zIndex:999999,theme:"rongcloud-rebox"}).bind("rebox:open",function(){var e=document.getElementsByClassName("rongcloud-rebox")[0];e.onclick=function(t){if("img"!=t.target.tagName.toLowerCase()){var o=document.getElementsByClassName("rongcloud-rebox-close")[0];o.click(),e=null,o=null}}})}),n.onload=function(){e.$apply(function(){e.msg.content=e.msg.imageUri})},e.showBigImage=function(){}},e}(),c=function(){function e(t){this.$timeout=t,this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-audio"><span class="rongcloud-Message-entry" style=""><span class="rongcloud-audioBox rongcloud-clearfix " ng-click="play()" ng-class="{\'rongcloud-animate\':isplaying}" ><i></i><i></i><i></i></span><div style="display: inline-block;" ><span class="rongcloud-audioTimer">{{msg.duration}}”</span><span class="rongcloud-audioState" ng-show="msg.isUnReade"></span></div></span></div></div>',e.prototype.link=function(e,o,n){e.msg.duration=parseInt(e.msg.duration||e.msg.content.length/1024),RongIMLib.RongIMVoice.preLoaded(e.msg.content),e.play=function(){RongIMLib.RongIMVoice.stop(e.msg.content),e.isplaying?(e.isplaying=!1,t.cancel(e.timeoutid)):(e.msg.isUnReade=!1,RongIMLib.RongIMVoice.play(e.msg.content,e.msg.duration),e.isplaying=!0,e.timeoutid&&t.cancel(e.timeoutid),e.timeoutid=t(function(){e.isplaying=!1},1e3*e.msg.duration))}}}return e.$inject=["$timeout"],e}(),l=function(){function e(){this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-map"><span class="rongcloud-Message-entry" style=""><div class="rongcloud-mapBox"><img ng-src="{{msg.content}}" alt=""><span>{{msg.poi}}</span></div></span></div></div>'}return e}(),d=function(){function e(){this.restrict="E",this.scope={msg:"="},this.template='<div class=""><div class="rongcloud-Message-image-text"><span class="rongcloud-Message-entry" style=""><div class="rongcloud-image-textBox"><h4>{{msg.title}}</h4><div class="rongcloud-cont rongcloud-clearfix"><img ng-src="{{msg.imageUri}}" alt=""><div>{{msg.content}}</div></div></div></span></div></div>'}return e}();angular.module("RongWebIMWidget.conversation").directive("rongConversation",o(n)).directive("emoji",o(i)).directive("textmessage",o(r)).directive("includinglinkmessage",o(s)).directive("imagemessage",o(a)).directive("voicemessage",o(c)).directive("locationmessage",o(l)).directive("richcontentmessage",o(d))}(t=e.conversation||(e.conversation={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(t){var o=function(){function e(){this.human={}}return e}(),n=function(){function t(t,n){this.$q=t,this.providerdata=n,this.current=new e.Conversation,this._cacheHistory={},this._customService=new o}return t.prototype.unshiftHistoryMessages=function(t,o,n){var i=o+"_"+t,r=this._cacheHistory[i]=this._cacheHistory[i]||[];r[0]&&r[0].sentTime&&r[0].panelType!=e.PanelType.Time&&n.sentTime&&(e.Helper.timeCompare(r[0].sentTime,n.sentTime)||r.unshift(new e.TimePanl(r[0].sentTime))),r.unshift(n)},t.prototype._getHistoryMessages=function(t,o,n,i){var r=this.$q.defer(),s=this;return RongIMLib.RongIMClient.getInstance().getHistoryMessages(t,o,i?0:null,n,{onSuccess:function(n,i){for(var a=n.length;a--;){var c=e.Message.convert(n[a]);s.unshiftHistoryMessages(o,t,c),c.content&&s.providerdata.getUserInfo&&!function(t){s.providerdata.getUserInfo(t.senderUserId,{onSuccess:function(o){t.content.userInfo=new e.UserInfo(o.userId,o.name,o.portraitUri)}})}(c)}r.resolve({data:n,has:i})},onError:function(e){r.reject(e)}}),r.promise},t.prototype._addHistoryMessages=function(t){var o=t.conversationType+"_"+t.targetId,n=this._cacheHistory[o]=this._cacheHistory[o]||[];n[n.length-1]&&n[n.length-1].panelType!=e.PanelType.Time&&n[n.length-1].sentTime&&t.sentTime&&(e.Helper.timeCompare(n[n.length-1].sentTime,t.sentTime)||n.push(new e.TimePanl(t.sentTime))),n.push(t)},t.prototype.updateUploadToken=function(){var e=this;RongIMLib.RongIMClient.getInstance().getFileToken(RongIMLib.FileType.IMAGE,{onSuccess:function(t){e._uploadToken=t.token},onError:function(){}})},t.$inject=["$q","ProviderData"],t}();angular.module("RongWebIMWidget.conversation").service("ConversationServer",n)}(t=e.conversation||(e.conversation={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(e){var t=function(){function e(e,t,o){this.$scope=e,this.conversationListServer=t,this.WebIMWidget=o,e.minbtn=function(){o.display=!1},e.conversationListServer=t}return e.$inject=["$scope","ConversationListServer","WebIMWidget"],e}();angular.module("RongWebIMWidget.conversationlist").controller("conversationListController",t)}(t=e.conversationlist||(e.conversationlist={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(t){var o=e.DirectiveFactory.GetFactoryFor,n=function(){function e(){this.restrict="E",this.templateUrl="./src/ts/conversationlist/conversationList.tpl.html",this.controller="conversationListController"}return e.prototype.link=function(e,t){window.jQuery&&window.jQuery.nicescroll&&$(t).find(".rongcloud-content").niceScroll({cursorcolor:"#0099ff",cursoropacitymax:1,touchbehavior:!1,cursorwidth:"8px",cursorborder:"0",cursorborderradius:"5px"})},e}(),i=function(){function t(o,n,i){this.conversationServer=o,this.conversationListServer=n,this.RongIMSDKServer=i,this.restrict="E",this.scope={item:"="},this.template='<div class="rongcloud-chatList"><div class="rongcloud-chat_item " ng-class="{\'rongcloud-online\':item.onLine}"><div class="rongcloud-ext"><p class="rongcloud-attr clearfix"><span class="rongcloud-badge" ng-show="item.unreadMessageCount>0">{{item.unreadMessageCount>99?"99+":item.unreadMessageCount}}</span><i class="rongcloud-sprite rongcloud-no-remind" ng-click="remove($event)"></i></p></div><div class="rongcloud-photo"><img class="rongcloud-img" ng-src="{{item.portraitUri}}" err-src="http://7xo1cb.com1.z0.glb.clouddn.com/rongcloudkefu2.png" alt=""><i ng-show="!!$parent.data.getOnlineStatus&&item.targetType==1" class="rongcloud-Presence rongcloud-Presence--stacked rongcloud-Presence--mainBox"></i></div><div class="rongcloud-info"><h3 class="rongcloud-nickname"><span class="rongcloud-nickname_text" title="{{item.title}}">{{item.title}}</span></h3></div></div></div>',t.prototype.link=function(t,r,s){r.on("click",function(){o.changeConversation(new e.Conversation(t.item.targetType,t.item.targetId,t.item.title)),t.item.unreadMessageCount>0&&(i.clearUnreadCount(t.item.targetType,t.item.targetId),i.sendReadReceiptMessage(t.item.targetId,Number(t.item.targetType)),n.updateConversations())}),t.remove=function(e){e.stopPropagation(),i.removeConversation(t.item.targetType,t.item.targetId).then(function(){o.current.targetType==t.item.targetType&&o.current.targetId==t.item.targetId,n.updateConversations()},function(e){})}}}return t.$inject=["ConversationServer","ConversationListServer","RongIMSDKServer"],t}();angular.module("RongWebIMWidget.conversationlist").directive("rongConversationList",o(n)).directive("conversationItem",o(i))}(t=e.conversationlist||(e.conversationlist={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t;!function(t){var o=function(){function t(e,t,o,n,i){this.$q=e,this.providerdata=t,this.widgetConfig=o,this.RongIMSDKServer=n,this.conversationServer=i,this._conversationList=[],this._onlineStatus=[]}return t.prototype.updateConversations=function(){var t=this.$q.defer(),o=this;return RongIMLib.RongIMClient.getInstance().getConversationList({onSuccess:function(n){o._conversationList.splice(0,o._conversationList.length);for(var i=0,r=n.length;r>i;i++){var s=e.Conversation.onvert(n[i]);switch(s.targetType){case RongIMLib.ConversationType.PRIVATE:"function"==e.Helper.checkType(o.providerdata.getUserInfo)&&!function(e,t){o.providerdata.getUserInfo(e.targetId,{onSuccess:function(o){e.title=o.name,e.portraitUri=o.portraitUri,t.conversationTitle=o.name,t.portraitUri=o.portraitUri}})}(s,n[i]);break;case RongIMLib.ConversationType.GROUP:"function"==e.Helper.checkType(o.providerdata.getGroupInfo)&&!function(e,t){o.providerdata.getGroupInfo(e.targetId,{onSuccess:function(o){e.title=o.name,e.portraitUri=o.portraitUri,t.conversationTitle=o.name,t.portraitUri=o.portraitUri}})}(s,n[i]);break;case RongIMLib.ConversationType.CHATROOM:s.title="聊天室："+s.targetId}o._conversationList.push(s)}if(o._onlineStatus.forEach(function(t){var n=o._getConversation(e.EnumConversationType.PRIVATE,t.id);n&&(n.onLine=t.status)}),o.widgetConfig.displayConversationList)RongIMLib.RongIMClient.getInstance().getTotalUnreadCount({onSuccess:function(e){o.providerdata.totalUnreadCount=e||0,t.resolve()},onError:function(){}});else{var a=o.conversationServer.current;a&&a.targetId&&o.RongIMSDKServer.getConversation(a.targetType,a.targetId).then(function(e){e&&e.unreadMessageCount?(o.providerdata.totalUnreadCount=e.unreadMessageCount||0,t.resolve()):(o.providerdata.totalUnreadCount=0,t.resolve())})}},onError:function(e){t.reject(e)}},null),t.promise},t.prototype._getConversation=function(e,t){for(var o=0,n=this._conversationList.length;n>o;o++)if(this._conversationList[o].targetType==e&&this._conversationList[o].targetId==t)return this._conversationList[o];return null},t.prototype.startRefreshOnlineStatus=function(){var e=this;e.widgetConfig.displayConversationList&&e.providerdata.getOnlineStatus&&(e._getOnlineStatus(),e.__intervale&&clearInterval(this.__intervale),e.__intervale=setInterval(function(){e._getOnlineStatus()},3e4))},t.prototype._getOnlineStatus=function(){var e=this,t=e._conversationList.map(function(e){return e.targetId});e.providerdata.getOnlineStatus(t,{onSuccess:function(t){e._onlineStatus=t,e.updateConversations()}})},t.prototype.stopRefreshOnlineStatus=function(){clearInterval(this.__intervale),this.__intervale=null},t.$inject=["$q","ProviderData","WidgetConfig","RongIMSDKServer","ConversationServer"],t}();angular.module("RongWebIMWidget.conversationlist").service("ConversationListServer",o)}(t=e.conversationlist||(e.conversationlist={}))}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t=195,o=50,n=195,i=3,r=function(){function r(t,o,n,i,r,s,a){this.$q=t,this.conversationServer=o,this.conversationListServer=n,this.providerdata=i,this.widgetConfig=r,this.RongIMSDKServer=s,this.$log=a,this.display=!1,this.connected=!1,this.EnumConversationType=e.EnumConversationType,this.EnumConversationListPosition=e.EnumConversationListPosition}return r.prototype.init=function(r){var s=this;if(!window.RongIMLib||!window.RongIMLib.RongIMClient)return void(s.widgetConfig._config=r);var a=s.widgetConfig.style;angular.extend(s.widgetConfig,r),angular.extend(a,r.style),r.desktopNotification&&e.NotificationHelper.requestPermission();var c=document.getElementById("rongcloud-playsound");c&&"string"==typeof s.widgetConfig.voiceUrl?(c.src=s.widgetConfig.voiceUrl,s.widgetConfig.voiceNotification=!0):s.widgetConfig.voiceNotification=!1;var l=document.getElementById("rong-conversation"),d=document.getElementById("rong-conversation-list"),u=document.getElementById("rong-widget-minbtn");if(s.widgetConfig.__isKefu&&(u=document.getElementById("rong-widget-minbtn-kefu")),a)if(l.style.height=a.height+"px",l.style.width=a.width+"px",d.style.height=a.height+"px",a.positionFixed?(d.style.position="fixed",u.style.position="fixed",l.style.position="fixed"):(d.style.position="absolute",u.style.position="absolute",l.style.position="absolute"),s.widgetConfig.displayConversationList){if(u.style.display="inline-block",d.style.display="inline-block",s.widgetConfig.conversationListPosition==e.EnumConversationListPosition.left)isNaN(a.left)||(d.style.left=a.left+"px",u.style.left=a.left+"px",l.style.left=a.left+t+i+"px"),isNaN(a.right)||(d.style.right=a.right+a.width+i+"px",u.style.right=a.right+a.width+i+"px",l.style.right=a.right+"px");else{if(s.widgetConfig.conversationListPosition!=e.EnumConversationListPosition.right)throw new Error("config conversationListPosition value is invalid");isNaN(a.left)||(d.style.left=a.left+a.width+i+"px",u.style.left=a.left+a.width+i+"px",l.style.left=a.left+"px"),isNaN(a.right)||(d.style.right=a.right+"px",u.style.right=a.right+"px",l.style.right=a.right+t+i+"px")}isNaN(a.top)||(d.style.top=a.top+"px",u.style.top=a.top+a.height-o+"px",l.style.top=a.top+"px"),isNaN(a.bottom)||(d.style.bottom=a.bottom+"px",u.style.bottom=a.bottom+"px",l.style.bottom=a.bottom+"px")}else u.style.display="inline-block",d.style.display="none",l.style.left=a.left+"px",l.style.right=a.right+"px",l.style.top=a.top+"px",l.style.bottom=a.bottom+"px",u.style.top=a.top+a.height-o+"px",u.style.bottom=a.bottom+"px",u.style.left=a.left+a.width/2-n/2+"px",u.style.right=a.right+a.width/2-n/2+"px";0==s.widgetConfig.displayMinButton&&(u.style.display="none"),s.RongIMSDKServer.init(s.widgetConfig.appkey),s.RongIMSDKServer.connect(s.widgetConfig.token).then(function(t){s.conversationListServer.updateConversations(),s.conversationListServer.startRefreshOnlineStatus(),s.conversationServer._handleConnectSuccess&&s.conversationServer._handleConnectSuccess(),"function"==e.Helper.checkType(s.widgetConfig.onSuccess)&&s.widgetConfig.onSuccess(t),"function"==e.Helper.checkType(s.providerdata.getUserInfo)&&s.providerdata.getUserInfo(t,{onSuccess:function(t){s.providerdata.currentUserInfo=new e.UserInfo(t.userId,t.name,t.portraitUri)}})},function(e){e.tokenError?s.widgetConfig.onError&&"function"==typeof s.widgetConfig.onError&&s.widgetConfig.onError({code:0,info:"token 无效"}):s.widgetConfig.onError&&"function"==typeof s.widgetConfig.onError&&s.widgetConfig.onError({code:e.errorCode})}),s.RongIMSDKServer.setConnectionStatusListener({onChanged:function(e){switch(s.providerdata.connectionState=!1,e){case RongIMLib.ConnectionStatus.CONNECTED:s.$log.debug("链接成功"),s.providerdata.connectionState=!0;break;case RongIMLib.ConnectionStatus.CONNECTING:s.$log.debug("正在链接");break;case RongIMLib.ConnectionStatus.KICKED_OFFLINE_BY_OTHER_CLIENT:s.$log.debug("其他设备登录");break;case RongIMLib.ConnectionStatus.NETWORK_UNAVAILABLE:s.$log.debug("网络不可用");break;default:s.$log.debug(e)}}}),s.RongIMSDKServer.setOnReceiveMessageListener({onReceived:function(t){s.$log.debug(t);var o=e.Message.convert(t);switch("function"==e.Helper.checkType(s.providerdata.getUserInfo)&&o.content&&s.providerdata.getUserInfo(o.senderUserId,{onSuccess:function(t){t&&(o.content.userInfo=new e.UserInfo(t.userId,t.name,t.portraitUri))}}),t.messageType){case e.MessageType.VoiceMessage:o.content.isUnReade=!0;case e.MessageType.TextMessage:case e.MessageType.LocationMessage:case e.MessageType.ImageMessage:case e.MessageType.RichContentMessage:s.addMessageAndOperation(o);var n=1==s.providerdata.voiceSound&&c&&t.messageDirection==e.MessageDirection.RECEIVE&&s.widgetConfig.voiceNotification,i=s.conversationServer.current&&s.conversationServer.current.targetType==o.conversationType&&s.conversationServer.current.targetId==o.targetId,r=(document.hidden||!s.display)&&t.messageDirection==e.MessageDirection.RECEIVE&&s.widgetConfig.desktopNotification;(s.widgetConfig.displayConversationList&&n||!s.widgetConfig.displayConversationList&&n&&i)&&c.play(),(r&&s.widgetConfig.displayConversationList||!s.widgetConfig.displayConversationList&&r&&i)&&e.NotificationHelper.showNotification({title:o.content.userInfo.name,icon:"",body:e.Message.messageToNotification(t),data:{targetId:o.targetId,targetType:o.conversationType}});break;case e.MessageType.ContactNotificationMessage:break;case e.MessageType.InformationNotificationMessage:s.addMessageAndOperation(o);break;case e.MessageType.UnknownMessage:break;case e.MessageType.ReadReceiptMessage:t.messageDirection==e.MessageDirection.SEND&&s.RongIMSDKServer.clearUnreadCount(t.conversationType,t.targetId)}s.onReceivedMessage&&s.onReceivedMessage(o),s.conversationServer.handleMessage(o),!document.hidden&&s.display&&s.conversationServer.current&&s.conversationServer.current.targetType==o.conversationType&&s.conversationServer.current.targetId==o.targetId&&t.messageDirection==e.MessageDirection.RECEIVE&&t.messageType!=e.MessageType.ReadReceiptMessage&&(s.RongIMSDKServer.clearUnreadCount(s.conversationServer.current.targetType,s.conversationServer.current.targetId),s.RongIMSDKServer.sendReadReceiptMessage(s.conversationServer.current.targetId,s.conversationServer.current.targetType)),s.conversationListServer.updateConversations().then(function(){})}}),window.onfocus=function(){s.conversationServer.current&&s.conversationServer.current.targetId&&s.display&&s.RongIMSDKServer.getConversation(s.conversationServer.current.targetType,s.conversationServer.current.targetId).then(function(e){e&&e.unreadMessageCount>0&&(s.RongIMSDKServer.clearUnreadCount(s.conversationServer.current.targetType,s.conversationServer.current.targetId),s.RongIMSDKServer.sendReadReceiptMessage(s.conversationServer.current.targetId,s.conversationServer.current.targetType),s.conversationListServer.updateConversations().then(function(){}))})}},r.prototype.addMessageAndOperation=function(t){var o=t.conversationType+"_"+t.targetId,n=this.conversationServer._cacheHistory[o]=this.conversationServer._cacheHistory[o]||[];0==n.length&&(t.conversationType!=e.EnumConversationType.CUSTOMER_SERVICE&&n.push(new e.GetHistoryPanel),n.push(new e.TimePanl(t.sentTime))),this.conversationServer._addHistoryMessages(t)},r.prototype.setConversation=function(t,o,n){this.conversationServer.changeConversation(new e.Conversation(t,o,n))},r.prototype.setUserInfoProvider=function(e){this.providerdata.getUserInfo=e},r.prototype.setGroupInfoProvider=function(e){this.providerdata.getGroupInfo=e},r.prototype.setOnlineStatusProvider=function(e){this.providerdata.getOnlineStatus=e},r.prototype.show=function(){this.display=!0},r.prototype.hidden=function(){this.display=!1},r.prototype.getCurrentConversation=function(){return this.conversationServer.current},r.$inject=["$q","ConversationServer","ConversationListServer","ProviderData","WidgetConfig","RongIMSDKServer","$log"],r}();e.WebIMWidget=r,angular.module("RongWebIMWidget").service("WebIMWidget",r)}(RongWebIMWidget||(RongWebIMWidget={}));var Evaluate;!function(e){var t=function(){function e(t){this.$timeout=t,this.restrict="E",this.scope={type:"=",display:"=",enter:"&confirm",dcancle:"&cancle"},this.templateUrl="./src/ts/evaluate/evaluate.tpl.html",e.prototype.link=function(e,o){function n(o){e.end=!0,o?t(function(){e.display=!1,e.end=!1,e.enter({data:o})},800):(e.display=!1,e.end=!1,e.enter({data:o}))}var i=[!1,!1,!1,!1,!1],r=[{display:"答非所问"},{display:"理解能力差"},{display:"一问三不知"},{display:"不礼貌"}],s=!1;e.stars=i,e.labels=RongWebIMWidget.Helper.cloneObject(r),e.end=!1,e.displayDescribe=!1,e.data={stars:0,value:0,describe:"",label:""},e.$watch("display",function(t,o){t!==o&&(s=!1,e.displayDescribe=!1,e.labels=RongWebIMWidget.Helper.cloneObject(r),e.data={stars:0,value:0,describe:"",label:""})}),e.mousehover=function(t){!s&&(e.data.stars=t)},e.confirm=function(t){void 0!=t?(s=!0,1==e.type?(e.data.stars=t,5!=e.data.stars?e.displayDescribe=!0:n(e.data)):(e.data.value=t,e.data.value===!1?e.displayDescribe=!0:n(e.data))):n(null)},e.commit=function(){n(e.data)},e.cancle=function(){e.display=!1,e.dcancle()}}}return e.$inject=["$timeout"],e}();angular.module("Evaluate",[]).directive("evaluatedir",RongWebIMWidget.DirectiveFactory.GetFactoryFor(t))}(Evaluate||(Evaluate={}));var RongWebIMWidget;!function(e){var t;!function(e){e[e.left=1]="left",e[e.right=2]="right"}(t||(t={}));var o=function(){function o(e){this.WebIMWidget=e,this.defaultconfig={__isKefu:!0},this.KefuPostion=t}return o.prototype.init=function(o){var n=this;angular.extend(this.defaultconfig,o);var i={right:20};o.position&&(i=o.position==t.left?{left:20,bottom:0,width:325,positionFixed:!0}:{right:20,bottom:0,width:325,positionFixed:!0}),i.width=this.defaultconfig.style.width,i.height=this.defaultconfig.style.height,this.defaultconfig.style=i,n.WebIMWidget.init(this.defaultconfig),n.WebIMWidget.onShow=function(){n.WebIMWidget.setConversation(e.EnumConversationType.CUSTOMER_SERVICE,o.kefuId,"客服")}},o.prototype.show=function(){this.WebIMWidget.show()},o.prototype.hidden=function(){this.WebIMWidget.hidden()},o.$inject=["WebIMWidget"],o}();angular.module("RongCloudkefu",["RongWebIMWidget"]).service("RongKefu",o)}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){function t(e,t,o){var n="https:"===location.protocol?"https:":"http:";$script.get(n+"//cdn.ronghub.com/RongIMLib-2.1.1.min.js",function(){$script.get(n+"//cdn.ronghub.com/RongEmoji-2.1.1.min.js",function(){RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.init()}),$script.get(n+"//cdn.ronghub.com/RongIMVoice-2.1.1.min.js",function(){RongIMLib.RongIMVoice&&RongIMLib.RongIMVoice.init()}),o._config&&t.init(o._config)}),$script.get(n+"//cdn.bootcss.com/plupload/2.1.8/plupload.full.min.js",function(){})}t.$inject=["$http","WebIMWidget","WidgetConfig"];var o=function(){function e(){this.restrict="E",this.templateUrl="./src/ts/main.tpl.html",this.controller="rongWidgetController"}return e}(),n=function(){function t(t,o,n,i,r,s,a,c){this.$scope=t,this.$interval=o,this.WebIMWidget=n,this.WidgetConfig=i,this.providerdata=r,this.conversationServer=s,this.conversationListServer=a,this.RongIMSDKServer=c,t.main=n,t.config=i,t.data=r;var l=e.Helper.CookieHelper.getCookie("rongcloud.voiceSound");r.voiceSound=l?"true"==l:!0,t.$watch("data.voiceSound",function(t,o){t!==o&&e.Helper.CookieHelper.setCookie("rongcloud.voiceSound",t)});var d=null;t.$watch("data.totalUnreadCount",function(e,n){e>0?(d&&o.cancel(d),d=o(function(){t.twinkle=!t.twinkle},1e3)):o.cancel(d)}),t.$watch("main.display",function(){s.current&&s.current.targetId&&n.display&&c.getConversation(s.current.targetType,s.current.targetId).then(function(e){e&&e.unreadMessageCount>0&&(c.clearUnreadCount(s.current.targetType,s.current.targetId),c.sendReadReceiptMessage(s.current.targetId,s.current.targetType),a.updateConversations().then(function(){}))})}),n.show=function(){n.display=!0,n.fullScreen=!1,n.onShow&&n.onShow(),setTimeout(function(){t.$apply()})},n.hidden=function(){n.display=!1,setTimeout(function(){t.$apply()})},t.showbtn=function(){n.display=!0,n.onShow&&n.onShow()}}return t.$inject=["$scope","$interval","WebIMWidget","WidgetConfig","ProviderData","ConversationServer","ConversationListServer","RongIMSDKServer"],t}();angular.module("RongWebIMWidget").run(t).directive("rongWidget",e.DirectiveFactory.GetFactoryFor(o)).controller("rongWidgetController",n)}(RongWebIMWidget||(RongWebIMWidget={}));var __extends=this&&this.__extends||function(e,t){function o(){this.constructor=e}for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)},RongWebIMWidget;!function(e){!function(e){e[e.left=0]="left",e[e.right=1]="right"}(e.EnumConversationListPosition||(e.EnumConversationListPosition={}));e.EnumConversationListPosition;!function(e){e[e.PRIVATE=1]="PRIVATE",e[e.DISCUSSION=2]="DISCUSSION",e[e.GROUP=3]="GROUP",e[e.CHATROOM=4]="CHATROOM",e[e.CUSTOMER_SERVICE=5]="CUSTOMER_SERVICE",e[e.SYSTEM=6]="SYSTEM",e[e.APP_PUBLIC_SERVICE=7]="APP_PUBLIC_SERVICE",e[e.PUBLIC_SERVICE=8]="PUBLIC_SERVICE"}(e.EnumConversationType||(e.EnumConversationType={}));e.EnumConversationType;!function(e){e[e.SEND=1]="SEND",e[e.RECEIVE=2]="RECEIVE"}(e.MessageDirection||(e.MessageDirection={}));e.MessageDirection;!function(e){e[e.READ=1]="READ",e[e.LISTENED=2]="LISTENED",e[e.DOWNLOADED=4]="DOWNLOADED"}(e.ReceivedStatus||(e.ReceivedStatus={}));e.ReceivedStatus;!function(e){e[e.SENDING=10]="SENDING",e[e.FAILED=20]="FAILED",e[e.SENT=30]="SENT",e[e.RECEIVED=40]="RECEIVED",e[e.READ=50]="READ",e[e.DESTROYED=60]="DESTROYED"}(e.SentStatus||(e.SentStatus={}));var t;e.SentStatus;!function(e){e[e.left=1]="left",e[e.right=2]="right",e[e.top=3]="top",e[e.bottom=4]="bottom"}(t||(t={})),function(e){e[e.person=0]="person",e[e.robot=1]="robot",e[e.robotSwitchPerson=2]="robotSwitchPerson",e[e.notService=4]="notService"}(e.EnumInputPanelType||(e.EnumInputPanelType={}));e.EnumInputPanelType;e.MessageType={DiscussionNotificationMessage:"DiscussionNotificationMessage ",TextMessage:"TextMessage",ImageMessage:"ImageMessage",VoiceMessage:"VoiceMessage",RichContentMessage:"RichContentMessage",HandshakeMessage:"HandshakeMessage",UnknownMessage:"UnknownMessage",SuspendMessage:"SuspendMessage",LocationMessage:"LocationMessage",InformationNotificationMessage:"InformationNotificationMessage",ContactNotificationMessage:"ContactNotificationMessage",ProfileNotificationMessage:"ProfileNotificationMessage",CommandNotificationMessage:"CommandNotificationMessage",HandShakeResponseMessage:"HandShakeResponseMessage",ChangeModeResponseMessage:"ChangeModeResponseMessage",TerminateMessage:"TerminateMessage",CustomerStatusUpdateMessage:"CustomerStatusUpdateMessage",ReadReceiptMessage:"ReadReceiptMessage"},function(e){e[e.Message=1]="Message",e[e.InformationNotification=2]="InformationNotification",e[e.System=103]="System",e[e.Time=104]="Time",e[e.getHistory=105]="getHistory",e[e.getMore=106]="getMore",e[e.Other=0]="Other"}(e.PanelType||(e.PanelType={}));var o=e.PanelType,n=function(){function e(e){this.panelType=e}return e}();e.ChatPanel=n;var i=function(e){function t(t){e.call(this,o.Time),this.sentTime=t}return __extends(t,e),t}(n);e.TimePanl=i;var r=function(e){function t(){e.call(this,o.getHistory)}return __extends(t,e),t}(n);e.GetHistoryPanel=r;var s=function(e){function t(){e.call(this,o.getMore)}return __extends(t,e),t}(n);e.GetMoreMessagePanel=s;var a=function(e){function t(t){e.call(this,o.Time),this.sentTime=t}return __extends(t,e),t}(n);e.TimePanel=a;var c=function(t){function n(e,n,i,r,s,a,c,l,d,u,g,p,h){t.call(this,o.Message)}return __extends(n,t),n.convert=function(t){var o=new n;switch(o.conversationType=t.conversationType,o.extra=t.extra,o.objectName=t.objectName,o.messageDirection=t.messageDirection,o.messageId=t.messageId,o.receivedStatus=t.receivedStatus,o.receivedTime=new Date(t.receivedTime),o.senderUserId=t.senderUserId,o.sentStatus=t.sendStatusMessage,o.sentTime=new Date(t.sentTime),o.targetId=t.targetId,o.messageType=t.messageType,o.messageType){case e.MessageType.TextMessage:var i=new u,r=t.content.content;r=e.Helper.escapeSymbol.escapeHtml(r),RongIMLib.RongIMEmoji&&RongIMLib.RongIMEmoji.emojiToHTML&&(r=RongIMLib.RongIMEmoji.emojiToHTML(r)),i.content=r,o.content=i;break;case e.MessageType.ImageMessage:var s=new v,r=t.content.content||"";-1==r.indexOf("base64,")&&(r="data:image/png;base64,"+r),s.content=r,s.imageUri=t.content.imageUri,o.content=s;break;case e.MessageType.VoiceMessage:var a=new b;a.content=t.content.content,a.duration=t.content.duration,o.content=a;break;case e.MessageType.RichContentMessage:var c=new w;c.content=t.content.content,c.title=t.content.title,c.imageUri=t.content.imageUri,o.content=c;break;case e.MessageType.LocationMessage:var l=new y,r=t.content.content||"";-1==r.indexOf("base64,")&&(r="data:image/png;base64,"+r),l.content=r,l.latiude=t.content.latiude,l.longitude=t.content.longitude,l.poi=t.content.poi,o.content=l;break;case e.MessageType.InformationNotificationMessage:var d=new f;o.panelType=2,d.content=t.content.message,o.content=d;break;case e.MessageType.DiscussionNotificationMessage:var S=new M;S.extension=t.content.extension,S.operation=t.content.operation,S.type=t.content.type,S.isHasReceived=t.content.isHasReceived,o.content=S;case e.MessageType.HandShakeResponseMessage:var x=new g;x.status=t.content.status,x.msg=t.content.msg,x.data=t.content.data,o.content=x;break;case e.MessageType.ChangeModeResponseMessage:var I=new p;I.code=t.content.code,I.data=t.content.data,I.status=t.content.status,o.content=I;break;case e.MessageType.CustomerStatusUpdateMessage:var T=new m;T.serviceStatus=t.content.serviceStatus,o.content=T;break;case e.MessageType.TerminateMessage:var C=new h;C.code=t.content.code,o.content=C}return o.content&&(o.content.userInfo=t.content.user),o},n.messageToNotification=function(t){if(!t)return null;var o,n=t.messageType;if(n==e.MessageType.ImageMessage)o="[图片]";else if(n==e.MessageType.LocationMessage)o="[位置]";else if(n==e.MessageType.VoiceMessage)o="[语音]";else if(n==e.MessageType.ContactNotificationMessage||n==e.MessageType.CommandNotificationMessage)o="[通知消息]";else if("RC:GrpNtf"==t.objectName){var i=t.content.message.content.data.data;switch(t.content.message.content.operation){case"Add":o=i.targetUserDisplayNames?i.targetUserDisplayNames.join("、")+" 加入了群组":"加入群组";break;case"Quit":o=i.operatorNickname+" 退出了群组";break;case"Kicked":o=i.targetUserDisplayNames?i.targetUserDisplayNames.join("、")+" 被剔出群组":"移除群组";break;case"Rename":o=i.operatorNickname+" 修改了群名称";break;case"Create":o=i.operatorNickname+" 创建了群组";break;case"Dismiss":o=i.operatorNickname+" 解散了群组 "+i.targetGroupName}}else o=t.content?t.content.content:"",o=RongIMLib.RongIMEmoji.emojiToSymbol(o),o=o.replace(/\n/g," "),o=o.replace(/([\w]{49,50})/g,"$1 ");return o},n}(n);e.Message=c;var l=function(){function e(e,t,o){this.userId=e,this.name=t,this.portraitUri=o}return e}();e.UserInfo=l;var d=function(){function e(e,t,o){this.userId=e,this.name=t,this.portraitUri=o}return e}();e.GroupInfo=d;var u=function(){function e(e){e=e||{},this.content=e.content,this.userInfo=e.userInfo}return e}();e.TextMessage=u;var g=function(){function e(){}return e}();e.HandShakeResponseMessage=g;var p=function(){function e(){}return e}();e.ChangeModeResponseMessage=p;var h=function(){function e(){}return e}();e.TerminateMessage=h;var m=function(){function e(){}return e}();e.CustomerStatusUpdateMessage=m;var f=function(){function e(){}return e}();e.InformationNotificationMessage=f;var v=function(){function e(){}return e}();e.ImageMessage=v;var b=function(){function e(){}return e}();e.VoiceMessage=b;var y=function(){function e(){}return e}();e.LocationMessage=y;var w=function(){function e(){}return e}();e.RichContentMessage=w;var M=function(){function e(){}return e}();e.DiscussionNotificationMessage=M;var S=function(){function e(e,t,o){this.targetType=e,this.targetId=t,this.title=o||""}return e.onvert=function(t){var o=new e;return o.targetId=t.targetId,o.targetType=t.conversationType,o.title=t.conversationTitle,o.portraitUri=t.senderPortraitUri,o.unreadMessageCount=t.unreadMessageCount,o},e}();e.Conversation=S}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t=function(){function e(e){var t=this;this.$q=e,this.connect=function(e){var o=t.$q.defer();return RongIMLib.RongIMClient.connect(e,{onSuccess:function(e){o.resolve(e)},onTokenIncorrect:function(){o.reject({tokenError:!0})},onError:function(e){o.reject({errorCode:e});var t="";switch(e){case RongIMLib.ErrorCode.TIMEOUT:t="连接超时";break;case RongIMLib.ErrorCode.UNKNOWN:t="未知错误";break;case RongIMLib.ConnectionState.UNACCEPTABLE_PROTOCOL_VERSION:t="不可接受的协议版本";break;case RongIMLib.ConnectionState.IDENTIFIER_REJECTED:t="appkey不正确";break;case RongIMLib.ConnectionState.SERVER_UNAVAILABLE:
t="服务器不可用";break;case RongIMLib.ConnectionState.NOT_AUTHORIZED:t="未认证";break;case RongIMLib.ConnectionState.REDIRECT:t="重新获取导航";break;case RongIMLib.ConnectionState.APP_BLOCK_OR_DELETE:t="应用已被封禁或已被删除";break;case RongIMLib.ConnectionState.BLOCK:t="用户被封禁"}console.log("失败:"+t)}}),o.promise},this.getConversation=function(e,o){var n=t.$q.defer();return RongIMLib.RongIMClient.getInstance().getConversation(Number(e),o,{onSuccess:function(e){n.resolve(e)},onError:function(){n.reject()}}),n.promise},this.getFileToken=function(){var e=t.$q.defer();return RongIMLib.RongIMClient.getInstance().getFileToken(RongIMLib.FileType.IMAGE,{onSuccess:function(t){t?e.resolve(t.token):e.reject()},onError:function(){e.reject()}}),e.promise}}return e.prototype.init=function(e){RongIMLib.RongIMClient.init(e)},e.prototype.setOnReceiveMessageListener=function(e){RongIMLib.RongIMClient.setOnReceiveMessageListener(e)},e.prototype.setConnectionStatusListener=function(e){RongIMLib.RongIMClient.setConnectionStatusListener(e)},e.prototype.startCustomService=function(e){var t=this.$q.defer();return RongIMLib.RongIMClient.getInstance().startCustomService(e,{onSuccess:function(){t.resolve()},onError:function(){t.reject()}}),t.promise},e.prototype.sendReadReceiptMessage=function(e,t){var o=this;RongIMLib.RongIMClient.getInstance().getConversation(Number(t),e,{onSuccess:function(n){if(n){var i=RongIMLib.ReadReceiptMessage.obtain(n.latestMessage.messageUId,n.latestMessage.sentTime,"1");o.sendMessage(t,e,i)}},onError:function(){}})},e.prototype.sendMessage=function(e,t,o){var n=this.$q.defer();return RongIMLib.RongIMClient.getInstance().sendMessage(+e,t,o,{onSuccess:function(e){n.resolve(e)},onError:function(e,t){n.reject({errorCode:e,message:t});var o="";switch(e){case RongIMLib.ErrorCode.TIMEOUT:o="超时";break;case RongIMLib.ErrorCode.UNKNOWN:o="未知错误";break;case RongIMLib.ErrorCode.REJECTED_BY_BLACKLIST:o="在黑名单中，无法向对方发送消息";break;case RongIMLib.ErrorCode.NOT_IN_DISCUSSION:o="不在讨论组中";break;case RongIMLib.ErrorCode.NOT_IN_GROUP:o="不在群组中";break;case RongIMLib.ErrorCode.NOT_IN_CHATROOM:o="不在聊天室中";break;default:o=""}console.log("发送失败:"+o)}}),n.promise},e.prototype.evaluateHumanCustomService=function(e,t,o){var n=this.$q.defer();return RongIMLib.RongIMClient.getInstance().evaluateHumanCustomService(e,t,o,{onSuccess:function(){n.resolve()},onError:function(){n.reject()}}),n.promise},e.prototype.reconnect=function(e){RongIMLib.RongIMClient.reconnect(e)},e.prototype.disconnect=function(){RongIMLib.RongIMClient.getInstance().disconnect()},e.prototype.logout=function(){RongIMLib&&RongIMLib.RongIMClient&&RongIMLib.RongIMClient.getInstance().logout()},e.prototype.clearUnreadCount=function(e,t){var o=this.$q.defer();return RongIMLib.RongIMClient.getInstance().clearUnreadCount(e,t,{onSuccess:function(e){o.resolve(e)},onError:function(e){o.reject(e)}}),o.promise},e.prototype.getTotalUnreadCount=function(){var e=this.$q.defer();return RongIMLib.RongIMClient.getInstance().getTotalUnreadCount({onSuccess:function(t){e.resolve(t)},onError:function(){e.reject()}}),e.promise},e.prototype.getConversationList=function(){var e=this.$q.defer();return RongIMLib.RongIMClient.getInstance().getConversationList({onSuccess:function(t){e.resolve(t)},onError:function(t){e.reject(t)}},null),e.promise},e.prototype.removeConversation=function(e,t){var o=this.$q.defer();return RongIMLib.RongIMClient.getInstance().removeConversation(e,t,{onSuccess:function(e){o.resolve(e)},onError:function(e){o.reject(e)}}),o.promise},e.prototype.getHistoryMessages=function(e,t,o){var n=this.$q.defer();return RongIMLib.RongIMClient.getInstance().getHistoryMessages(e,t,null,o,{onSuccess:function(e,t){n.resolve({data:e,has:t})},onError:function(e){n.reject(e)}}),n.promise},e.prototype.getDraft=function(e,t){return RongIMLib.RongIMClient.getInstance().getTextMessageDraft(e,t)||""},e.prototype.setDraft=function(e,t,o){return RongIMLib.RongIMClient.getInstance().saveTextMessageDraft(e,t,o)},e.prototype.clearDraft=function(e,t){return RongIMLib.RongIMClient.getInstance().clearTextMessageDraft(e,t)},e.$inject=["$q"],e}();e.RongIMSDKServer=t,angular.module("RongWebIMWidget").service("RongIMSDKServer",t)}(RongWebIMWidget||(RongWebIMWidget={}));var RongWebIMWidget;!function(e){var t=function(){function e(){this._cacheUserInfo=[],this._cacheGroupInfo=[],this.totalUnreadCount=0,this.connectionState=!1,this.voiceSound=!1,this.currentUserInfo={}}return e.prototype._getCacheUserInfo=function(e){for(var t=0,o=this._cacheUserInfo.length;o>t;t++)if(this._cacheUserInfo[t].userId==e)return this._cacheUserInfo[t];return null},e.prototype._addUserInfo=function(e){var t=this._getCacheUserInfo(e.userId);t?angular.extend(t,e):this._cacheUserInfo.push(e)},e}();e.ProviderData=t;var o=(function(){function e(){}return e}(),function(){function t(){this.displayConversationList=!1,this.conversationListPosition=e.EnumConversationListPosition.left,this.displayMinButton=!0,this.desktopNotification=!1,this.reminder="",this.voiceNotification=!1,this.style={positionFixed:!1,width:450,height:470,bottom:0,right:0},this.refershOnlineStateIntercycle=2e4,this.__isKefu=!1}return t}());e.WidgetConfig=o,angular.module("RongWebIMWidget").service("ProviderData",t).service("WidgetConfig",o)}(RongWebIMWidget||(RongWebIMWidget={})),angular.module("RongWebIMWidget").run(["$templateCache",function(e){"use strict";e.put("./src/ts/conversation/conversation.tpl.html",'<div id=rong-conversation class="rongcloud-kefuChatBox rongcloud-both rongcloud-am-fade-and-slide-top" ng-show=showSelf ng-class="{\'rongcloud-fullScreen\':resoures.fullScreen}"><evaluatedir type=evaluate.type display=evaluate.showSelf confirm=evaluate.onConfirm(data) cancle=evaluate.onCancle()></evaluatedir><div class=rongcloud-kefuChat><div id=header class="rongcloud-rong-header rongcloud-blueBg rongcloud-online"><div class="rongcloud-infoBar rongcloud-pull-left"><div class=rongcloud-infoBarTit><span class=rongcloud-kefuName ng-bind=conversation.title></span></div></div><div class="rongcloud-toolBar rongcloud-headBtn rongcloud-pull-right"><div ng-show=!config.displayConversationList&&config.voiceNotification class=rongcloud-voice ng-class="{\'rongcloud-voice-mute\':!data.voiceSound,\'rongcloud-voice-sound\':data.voiceSound}" ng-click="data.voiceSound=!data.voiceSound"></div><a href=javascript:; class="rongcloud-kefuChatBoxHide rongcloud-sprite" style=margin-right:6px ng-show=!config.displayConversationList ng-click=minimize() title=隐藏></a> <a href=javascript:; class="rongcloud-kefuChatBoxClose rongcloud-sprite" ng-click=close() title=结束对话></a></div></div><div class=rongcloud-outlineBox ng-hide=data.connectionState><div class=rongcloud-sprite></div><span>连接断开,请刷新重连</span></div><div id=Messages><div class=rongcloud-emptyBox>暂时没有新消息</div><div class=rongcloud-MessagesInner><div ng-repeat="item in messageList" ng-switch=item.panelType><div class=rongcloud-Messages-date ng-switch-when=104><b>{{item.sentTime|historyTime}}</b></div><div class=rongcloud-Messages-history ng-switch-when=105><b ng-click=getHistory()>查看历史消息</b></div><div class=rongcloud-Messages-history ng-switch-when=106><b ng-click=getMoreMessage()>获取更多消息</b></div><div class=rongcloud-sys-tips ng-switch-when=2><span ng-bind-html=item.content.content|trustHtml></span></div><div class=rongcloud-Message ng-switch-when=1><div class=rongcloud-Messages-unreadLine></div><div><div class=rongcloud-Message-header><img class="rongcloud-img rongcloud-u-isActionable rongcloud-Message-avatar rongcloud-avatar" ng-src={{item.content.userInfo.portraitUri||item.content.userInfo.icon}} err-src=http://7xo1cb.com1.z0.glb.clouddn.com/rongcloudkefu2.png errsrcserasdfasdfasdfa alt=""><div class="rongcloud-Message-author rongcloud-clearfix"><a class="rongcloud-author rongcloud-u-isActionable">{{item.content.userInfo.name}}</a></div></div></div><div class=rongcloud-Message-body ng-switch=item.messageType><textmessage ng-switch-when=TextMessage msg=item.content></textmessage><imagemessage ng-switch-when=ImageMessage msg=item.content></imagemessage><voicemessage ng-switch-when=VoiceMessage msg=item.content></voicemessage><locationmessage ng-switch-when=LocationMessage msg=item.content></locationmessage><richcontentmessage ng-switch-when=RichContentMessage msg=item.content></richcontentmessage></div></div></div></div></div><div id=footer class=rongcloud-rong-footer style="display: block"><div class=rongcloud-footer-con><div class=rongcloud-text-layout><div id=funcPanel class="rongcloud-funcPanel rongcloud-robotMode"><div class=rongcloud-mode1 ng-show="_inputPanelState==0"><div class=rongcloud-MessageForm-tool id=expressionWrap><i class="rongcloud-sprite rongcloud-iconfont-smile" ng-click="showemoji=!showemoji"></i><div class=rongcloud-expressionWrap ng-show=showemoji><i class=rongcloud-arrow></i><emoji ng-repeat="item in emojiList" item=item content=conversation></emoji></div></div><div class=rongcloud-MessageForm-tool><i class="rongcloud-sprite rongcloud-iconfont-upload" id=upload-file style="position: relative; z-index: 1"></i></div></div><div class=rongcloud-mode2 ng-show="_inputPanelState==2"><a ng-click=switchPerson() id=chatSwitch class=rongcloud-chatSwitch>转人工服务</a></div></div><pre id=inputMsg class="rongcloud-text rongcloud-grey" contenteditable contenteditable-dire ng-focus="showemoji=fase" style="background-color: rgba(0,0,0,0);color:black" ctrl-enter-keys fun=send() ctrlenter=false placeholder=请输入文字... ondrop="return false" ng-model=conversation.messageContent></pre></div><div class=rongcloud-powBox><button type=button style="background-color: #0099ff" class="rongcloud-rong-btn rongcloud-rong-send-btn" id=rong-sendBtn ng-click=send()>发送</button></div></div></div></div></div>'),e.put("./src/ts/conversationlist/conversationList.tpl.html",'<div id=rong-conversation-list class="rongcloud-kefuListBox rongcloud-both"><div class=rongcloud-kefuList><div class="rongcloud-rong-header rongcloud-blueBg"><div class="rongcloud-toolBar rongcloud-headBtn"><div ng-show=config.voiceNotification class=rongcloud-voice ng-class="{\'rongcloud-voice-mute\':!data.voiceSound,\'rongcloud-voice-sound\':data.voiceSound}" ng-click="data.voiceSound=!data.voiceSound"></div><div class="rongcloud-sprite rongcloud-people"></div><span class=rongcloud-recent>最近联系人</span><div class="rongcloud-sprite rongcloud-arrow-down" style="cursor: pointer" ng-click=minbtn()></div></div></div><div class=rongcloud-content><div class=rongcloud-netStatus ng-hide=data.connectionState><div class=rongcloud-sprite></div><span>连接断开,请刷新重连</span></div><div><conversation-item ng-repeat="item in conversationListServer._conversationList" item=item></conversation-item></div></div></div></div>'),e.put("./src/ts/evaluate/evaluate.tpl.html",'<div class=rongcloud-layermbox ng-show=display><div class=rongcloud-laymshade></div><div class=rongcloud-layermmain><div class=rongcloud-section><div class=rongcloud-layermchild ng-show=!end><div class=rongcloud-layermcont><div class=rongcloud-type1 ng-show="type==1"><h4>&nbsp;评价客服</h4><div class=rongcloud-layerPanel1><div class=rongcloud-star><span ng-repeat="item in stars track by $index"><span ng-class="{\'rongcloud-star-on\':$index<data.stars,\'rongcloud-star-off\':$index>=data.stars}" ng-click=confirm($index+1) ng-mouseenter=mousehover($index+1) ng-mouseleave=mousehover(0)></span></span></div></div></div><div class=rongcloud-type2 ng-show="type==2"><h4>&nbsp;&nbsp;机器人是否解决了您的问题 ？</h4><div class=rongcloud-layerPanel1><a class="rongcloud-rong-btn rongcloud-btnY" ng-class="{\'rongcloud-cur\':data.value===true}" href=javascript:void(0); ng-click=confirm(true)>是</a> <a class="rongcloud-rong-btn rongcloud-btnN" ng-class="{\'rongcloud-cur\':data.value===false}" href=javascript:void(0); ng-click=confirm(false)>否</a></div></div><div class=rongcloud-layerPanel2 ng-show=displayDescribe><p>是否有以下情况 ？</p><div class=rongcloud-labels><span ng-repeat="item in labels"><a class=rongcloud-rong-btn ng-class="{\'rongcloud-cur\':item.selected}" ng-click="item.selected=!item.selected" href="">{{item.display}}</a></span></div><div class=rongcloud-suggestBox><textarea name="" placeholder=欢迎给我们的服务提建议~ ng-model=data.describe></textarea></div><div class=rongcloud-subBox><a class=rongcloud-rong-btn href="" ng-click=commit()>提交评价</a></div></div></div><div class=rongcloud-layermbtn><span ng-click=confirm()>跳过</span><span ng-click=cancle()>取消</span></div></div><div class="rongcloud-layermchild rongcloud-feedback" ng-show=end><div class=rongcloud-layermcont>感谢您的反馈 ^ - ^ ！</div></div></div></div></div>'),e.put("./src/ts/main.tpl.html",'<div id=rong-widget-box class=rongcloud-container><div ng-show=main.display><rong-conversation></rong-conversation><rong-conversation-list></rong-conversation-list></div><div id=rong-widget-minbtn class="rongcloud-kefuBtnBox rongcloud-blueBg" ng-show=!main.display&&config.displayMinButton ng-click=showbtn()><a class=rongcloud-kefuBtn href="javascript: void(0);"><div class="rongcloud-sprite rongcloud-people"></div><span class=rongcloud-recent ng-show="!data.totalUnreadCount||data.totalUnreadCount==0">{{config.reminder||"最近联系人"}}</span> <span class=rongcloud-recent ng-show="data.totalUnreadCount>0"><span ng-show=twinkle>(有未读消息)</span></span></a></div><div id=rong-widget-minbtn-kefu class="rongcloud-kefuBtnBox rongcloud-blueBg" ng-show=!main.display&&config.displayMinButton ng-click=showbtn()><a class=rongcloud-kefuBtn href="javascript: void(0);"><div class="rongcloud-sprite rongcloud-people rongcloud-sprite-kefu"></div><span class=rongcloud-recent>{{config.reminder||"联系客服"}}</span></a></div><audio id=rongcloud-playsound style="width: 0px;height: 0px;display: none" src="" controls></audio></div>')}]),function(e,t){"undefined"!=typeof module&&module.exports?module.exports=t():"function"==typeof define&&define.amd?define(t):this[e]=t()}("$script",function(){function e(e,t){for(var o=0,n=e.length;n>o;++o)if(!t(e[o]))return c;return 1}function t(t,o){e(t,function(e){return!o(e)})}function o(r,s,a){function c(e){return e.call?e():g[e]}function d(){if(!--b){g[v]=1,f&&f();for(var o in h)e(o.split("|"),c)&&!t(h[o],c)&&(h[o]=[])}}r=r[l]?r:[r];var u=s&&s.call,f=u?s:a,v=u?r.join(""):s,b=r.length;return setTimeout(function(){t(r,function e(t,o){return null===t?d():(!o&&!/^https?:\/\//.test(t)&&i&&(t=-1===t.indexOf(".js")?i+t+".js":i+t),m[t]?(v&&(p[v]=1),2==m[t]?d():setTimeout(function(){e(t,!0)},0)):(m[t]=1,v&&(p[v]=1),n(t,d),void 0))})},0),o}function n(e,t){var o,n=s.createElement("script");n.onload=n.onerror=n[u]=function(){n[d]&&!/^c|loade/.test(n[d])||o||(n.onload=n[u]=null,o=1,m[e]=2,t())},n.async=1,n.src=r?e+(-1===e.indexOf("?")?"?":"&")+r:e,a.insertBefore(n,a.lastChild)}var i,r,s=document,a=s.getElementsByTagName("head")[0],c=!1,l="push",d="readyState",u="onreadystatechange",g={},p={},h={},m={};return o.get=n,o.order=function(e,t,n){!function i(r){r=e.shift(),e.length?o(r,i):o(r,t,n)}()},o.path=function(e){i=e},o.urlArgs=function(e){r=e},o.ready=function(n,i,r){n=n[l]?n:[n];var s=[];return!t(n,function(e){g[e]||s[l](e)})&&e(n,function(e){return g[e]})?i():!function(e){h[e]=h[e]||[],h[e][l](i),r&&r(s)}(n.join("|")),o},o.done=function(e){o([null],e)},o});var Qiniu=new QiniuJsSDK;